<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE PatternGuards, ViewPatterns, RecordWildCards, FlexibleContexts, ScopedTypeVariables #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">{-
The matching does a fairly simple unification between the two terms, treating
any single letter variable on the left as a free variable. After the matching
we substitute, transform and check the side conditions. We also &quot;see through&quot;
both ($) and (.) functions on the right.

TRANSFORM PATTERNS
_eval_ - perform deep evaluation, must be used at the top of a RHS
_noParen_ - don't bracket this particular item

SIDE CONDITIONS
(&amp;&amp;), (||), not - boolean connectives
isAtom x - does x never need brackets
isFoo x - is the root constructor of x a &quot;Foo&quot;
notEq x y - are x and y not equal
notIn xs ys - are all x variables not in ys expressions
noTypeCheck, noQuickCheck - no semantics, a hint for testing only

($) AND (.)
We see through ($)/(.) by expanding it if nothing else matches.
We also see through (.) by translating rules that have (.) equivalents
to separate rules. For example:

concat (map f x) ==&gt; concatMap f x
-- we spot both these rules can eta reduce with respect to x
concat . map f ==&gt; concatMap f
-- we use the associativity of (.) to add
concat . map f . x ==&gt; concatMap f . x
-- currently 36 of 169 rules have (.) equivalents

We see through (.) if the RHS is dull using id, e.g.

not (not x) ==&gt; x
not . not ==&gt; id
not . not . x ==&gt; x
-}</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hint.Match</span><span class="hs-special">(</span><a href="Hint.Match.html#readMatch"><span class="hs-identifier hs-var">readMatch</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Applicative</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List.Extra</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="Config.Type.html"><span class="hs-identifier">Config.Type</span></a><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><a href="Hint.Type.html"><span class="hs-identifier">Hint.Type</span></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Tuple.Extra</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="HSE.Unify.html"><span class="hs-identifier">HSE.Unify</span></a><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><a href="Timing.html"><span class="hs-identifier">Timing</span></a><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Set</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Set</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Refact.Types</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">R</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><a name="fmapAn"><a href="Hint.Match.html#fmapAn"><span class="hs-identifier">fmapAn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="HSE.Util.html#an"><span class="hs-identifier hs-var">an</span></a><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span class="hs-comment">---------------------------------------------------------------------</span><span>
</span><a name="line-61"></a><span class="hs-comment">-- READ THE RULE</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-identifier">readMatch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Config.Type.html#HintRule"><span class="hs-identifier hs-type">HintRule</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Hint.Type.html#DeclHint"><span class="hs-identifier hs-type">DeclHint</span></a><span>
</span><a name="line-64"></a><a name="readMatch"><a href="Hint.Match.html#readMatch"><span class="hs-identifier">readMatch</span></a></a><span> </span><a name="local-6989586621679289151"><a href="#local-6989586621679289151"><span class="hs-identifier">settings</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Hint.Match.html#findIdeas"><span class="hs-identifier hs-var">findIdeas</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="Hint.Match.html#readRule"><span class="hs-identifier hs-var">readRule</span></a><span> </span><a href="#local-6989586621679289151"><span class="hs-identifier hs-var">settings</span></a><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span class="hs-identifier">readRule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Config.Type.html#HintRule"><span class="hs-identifier hs-type">HintRule</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Config.Type.html#HintRule"><span class="hs-identifier hs-type">HintRule</span></a><span class="hs-special">]</span><span>
</span><a name="line-68"></a><a name="readRule"><a href="Hint.Match.html#readRule"><span class="hs-identifier">readRule</span></a></a><span> </span><a name="local-6989586621679289152"><a href="#local-6989586621679289152"><span class="hs-identifier">m</span></a></a><span class="hs-glyph">@</span><a href="Config.Type.html#HintRule"><span class="hs-identifier hs-var">HintRule</span></a><span class="hs-special">{</span><span class="hs-identifier">hintRuleLHS</span><span class="hs-glyph">=</span><span class="hs-special">(</span><a href="Hint.Match.html#fmapAn"><span class="hs-identifier hs-var">fmapAn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a name="local-6989586621679289153"><a href="#local-6989586621679289153"><span class="hs-identifier">hintRuleLHS</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hintRuleRHS</span><span class="hs-glyph">=</span><span class="hs-special">(</span><a href="Hint.Match.html#fmapAn"><span class="hs-identifier hs-var">fmapAn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a name="local-6989586621679289154"><a href="#local-6989586621679289154"><span class="hs-identifier">hintRuleRHS</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hintRuleSide</span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Hint.Match.html#fmapAn"><span class="hs-identifier hs-var">fmapAn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a name="local-6989586621679289155"><a href="#local-6989586621679289155"><span class="hs-identifier">hintRuleSide</span></a></a><span class="hs-special">)</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-69"></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679289152"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">{</span><span class="hs-identifier">hintRuleLHS</span><span class="hs-glyph">=</span><a href="#local-6989586621679289153"><span class="hs-identifier hs-var">hintRuleLHS</span></a><span class="hs-special">,</span><span class="hs-identifier">hintRuleSide</span><span class="hs-glyph">=</span><a href="#local-6989586621679289155"><span class="hs-identifier hs-var">hintRuleSide</span></a><span class="hs-special">,</span><span class="hs-identifier">hintRuleRHS</span><span class="hs-glyph">=</span><a href="#local-6989586621679289154"><span class="hs-identifier hs-var">hintRuleRHS</span></a><span class="hs-special">}</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-70"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679289156"><a href="#local-6989586621679289156"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621679289157"><a href="#local-6989586621679289157"><span class="hs-identifier">v1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Hint.Match.html#dotVersion"><span class="hs-identifier hs-var">dotVersion</span></a><span> </span><a href="#local-6989586621679289153"><span class="hs-identifier hs-var">hintRuleLHS</span></a><span>
</span><a name="line-71"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679289158"><a href="#local-6989586621679289158"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><a name="local-6989586621679289159"><a href="#local-6989586621679289159"><span class="hs-identifier">v2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Hint.Match.html#dotVersion"><span class="hs-identifier hs-var">dotVersion</span></a><span> </span><a href="#local-6989586621679289154"><span class="hs-identifier hs-var">hintRuleRHS</span></a><span>
</span><a name="line-72"></a><span>        </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679289157"><span class="hs-identifier hs-var">v1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679289159"><span class="hs-identifier hs-var">v2</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679289156"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679289156"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679289158"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">Set.notMember</span><span> </span><a href="#local-6989586621679289157"><span class="hs-identifier hs-var">v1</span></a><span> </span><span class="hs-special">(</span><a href="HSE.All.html#freeVars"><span class="hs-identifier hs-var">freeVars</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">maybeToList</span><span> </span><a href="#local-6989586621679289155"><span class="hs-identifier hs-var">hintRuleSide</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679289156"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679289158"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-73"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679289158"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-74"></a><span>            </span><span class="hs-special">[</span><a href="#local-6989586621679289152"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">{</span><span class="hs-identifier">hintRuleLHS</span><span class="hs-glyph">=</span><a href="HSE.Util.html#dotApps"><span class="hs-identifier hs-var">dotApps</span></a><span> </span><a href="#local-6989586621679289156"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hintRuleRHS</span><span class="hs-glyph">=</span><a href="HSE.Util.html#dotApps"><span class="hs-identifier hs-var">dotApps</span></a><span> </span><a href="#local-6989586621679289158"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hintRuleSide</span><span class="hs-glyph">=</span><a href="#local-6989586621679289155"><span class="hs-identifier hs-var">hintRuleSide</span></a><span class="hs-special">}</span><span>
</span><a name="line-75"></a><span>            </span><span class="hs-special">,</span><a href="#local-6989586621679289152"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">{</span><span class="hs-identifier">hintRuleLHS</span><span class="hs-glyph">=</span><a href="HSE.Util.html#dotApps"><span class="hs-identifier hs-var">dotApps</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679289156"><span class="hs-identifier hs-var">l</span></a><span class="hs-operator hs-var">++</span><span class="hs-special">[</span><a href="HSE.Match.html#toNamed"><span class="hs-identifier hs-var">toNamed</span></a><span> </span><a href="#local-6989586621679289157"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hintRuleRHS</span><span class="hs-glyph">=</span><a href="HSE.Util.html#dotApps"><span class="hs-identifier hs-var">dotApps</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679289158"><span class="hs-identifier hs-var">r</span></a><span class="hs-operator hs-var">++</span><span class="hs-special">[</span><a href="HSE.Match.html#toNamed"><span class="hs-identifier hs-var">toNamed</span></a><span> </span><a href="#local-6989586621679289157"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hintRuleSide</span><span class="hs-glyph">=</span><a href="#local-6989586621679289155"><span class="hs-identifier hs-var">hintRuleSide</span></a><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><a name="line-76"></a><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679289156"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-77"></a><span>            </span><span class="hs-special">[</span><a href="#local-6989586621679289152"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">{</span><span class="hs-identifier">hintRuleLHS</span><span class="hs-glyph">=</span><a href="HSE.Util.html#dotApps"><span class="hs-identifier hs-var">dotApps</span></a><span> </span><a href="#local-6989586621679289156"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hintRuleRHS</span><span class="hs-glyph">=</span><a href="HSE.Match.html#toNamed"><span class="hs-identifier hs-var">toNamed</span></a><span> </span><span class="hs-string">&quot;id&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hintRuleSide</span><span class="hs-glyph">=</span><a href="#local-6989586621679289155"><span class="hs-identifier hs-var">hintRuleSide</span></a><span class="hs-special">}</span><span>
</span><a name="line-78"></a><span>            </span><span class="hs-special">,</span><a href="#local-6989586621679289152"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">{</span><span class="hs-identifier">hintRuleLHS</span><span class="hs-glyph">=</span><a href="HSE.Util.html#dotApps"><span class="hs-identifier hs-var">dotApps</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679289156"><span class="hs-identifier hs-var">l</span></a><span class="hs-operator hs-var">++</span><span class="hs-special">[</span><a href="HSE.Match.html#toNamed"><span class="hs-identifier hs-var">toNamed</span></a><span> </span><a href="#local-6989586621679289157"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hintRuleRHS</span><span class="hs-glyph">=</span><a href="HSE.Match.html#toNamed"><span class="hs-identifier hs-var">toNamed</span></a><span> </span><a href="#local-6989586621679289157"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hintRuleSide</span><span class="hs-glyph">=</span><a href="#local-6989586621679289155"><span class="hs-identifier hs-var">hintRuleSide</span></a><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><a name="line-79"></a><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-comment">-- find a dot version of this rule, return the sequence of app prefixes, and the var</span><span>
</span><a name="line-83"></a><span class="hs-identifier">dotVersion</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-84"></a><a name="dotVersion"><a href="Hint.Match.html#dotVersion"><span class="hs-identifier">dotVersion</span></a></a><span> </span><span class="hs-special">(</span><a href="HSE.Match.html#view"><span class="hs-identifier hs-var">view</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Match.html#Var_"><span class="hs-identifier hs-var">Var_</span></a><span> </span><a name="local-6989586621679289160"><a href="#local-6989586621679289160"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Config.Type.html#isUnifyVar"><span class="hs-identifier hs-var">isUnifyVar</span></a><span> </span><a href="#local-6989586621679289160"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679289160"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-85"></a><span class="hs-identifier">dotVersion</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">App</span><span> </span><a name="local-6989586621679289161"><a href="#local-6989586621679289161"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679289162"><a href="#local-6989586621679289162"><span class="hs-identifier">ls</span></a></a><span> </span><a name="local-6989586621679289163"><a href="#local-6989586621679289163"><span class="hs-identifier">rs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679289162"><span class="hs-identifier hs-var">ls</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Hint.Match.html#dotVersion"><span class="hs-identifier hs-var">dotVersion</span></a><span> </span><span class="hs-special">(</span><a href="HSE.Util.html#fromParen"><span class="hs-identifier hs-var">fromParen</span></a><span> </span><a href="#local-6989586621679289163"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span class="hs-identifier">dotVersion</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixApp</span><span> </span><a name="local-6989586621679289164"><a href="#local-6989586621679289164"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679289165"><a href="#local-6989586621679289165"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679289166"><a href="#local-6989586621679289166"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621679289167"><a href="#local-6989586621679289167"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LeftSection</span><span> </span><a href="#local-6989586621679289164"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679289165"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679289166"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Hint.Match.html#dotVersion"><span class="hs-identifier hs-var">dotVersion</span></a><span> </span><a href="#local-6989586621679289167"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-87"></a><span>                                 </span><span class="hs-special">(</span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RightSection</span><span> </span><a href="#local-6989586621679289164"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679289166"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621679289167"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Hint.Match.html#dotVersion"><span class="hs-identifier hs-var">dotVersion</span></a><span> </span><a href="#local-6989586621679289165"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-88"></a><span class="hs-identifier">dotVersion</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-comment">---------------------------------------------------------------------</span><span>
</span><a name="line-92"></a><span class="hs-comment">-- PERFORM THE MATCHING</span><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span class="hs-identifier">findIdeas</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Config.Type.html#HintRule"><span class="hs-identifier hs-type">HintRule</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Scope.html#Scope"><span class="hs-identifier hs-type">Scope</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Module</span><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Type.html#Decl_"><span class="hs-identifier hs-type">Decl_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Idea.html#Idea"><span class="hs-identifier hs-type">Idea</span></a><span class="hs-special">]</span><span>
</span><a name="line-95"></a><a name="findIdeas"><a href="Hint.Match.html#findIdeas"><span class="hs-identifier">findIdeas</span></a></a><span> </span><a name="local-6989586621679289168"><a href="#local-6989586621679289168"><span class="hs-identifier">matches</span></a></a><span> </span><a name="local-6989586621679289169"><a href="#local-6989586621679289169"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679289170"><a href="#local-6989586621679289170"><span class="hs-identifier">decl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Timing.html#timed"><span class="hs-identifier hs-var">timed</span></a><span> </span><span class="hs-string">&quot;Hint&quot;</span><span> </span><span class="hs-string">&quot;Match apply&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Util.html#forceList"><span class="hs-identifier hs-var">forceList</span></a><span>
</span><a name="line-96"></a><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="Idea.html#idea"><span class="hs-identifier hs-var">idea</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">hintRuleSeverity</span><span> </span><a href="#local-6989586621679289174"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hintRuleName</span><span> </span><a href="#local-6989586621679289174"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679289173"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679289175"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679289178"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">{</span><span class="hs-identifier">ideaNote</span><span class="hs-glyph">=</span><a href="#local-6989586621679289176"><span class="hs-identifier hs-var">notes</span></a><span class="hs-special">}</span><span>
</span><a name="line-97"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679289171"><a href="#local-6989586621679289171"><span class="hs-identifier">decl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Hint.Match.html#findDecls"><span class="hs-identifier hs-var">findDecls</span></a><span> </span><a href="#local-6989586621679289170"><span class="hs-identifier hs-var">decl</span></a><span>
</span><a name="line-98"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679289172"><a href="#local-6989586621679289172"><span class="hs-identifier">parent</span></a></a><span class="hs-special">,</span><a name="local-6989586621679289173"><a href="#local-6989586621679289173"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HSE.Util.html#universeParentExp"><span class="hs-identifier hs-var">universeParentExp</span></a><span> </span><a href="#local-6989586621679289171"><span class="hs-identifier hs-var">decl</span></a><span>
</span><a name="line-99"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679289174"><a href="#local-6989586621679289174"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679289168"><span class="hs-identifier hs-var">matches</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679289175"><a href="#local-6989586621679289175"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><a name="local-6989586621679289176"><a href="#local-6989586621679289176"><span class="hs-identifier">notes</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679289177"><a href="#local-6989586621679289177"><span class="hs-identifier">subst</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><a href="Hint.Match.html#matchIdea"><span class="hs-identifier hs-var">matchIdea</span></a><span> </span><a href="#local-6989586621679289169"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679289171"><span class="hs-identifier hs-var">decl</span></a><span> </span><a href="#local-6989586621679289174"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679289172"><span class="hs-identifier hs-var">parent</span></a><span> </span><a href="#local-6989586621679289173"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span>
</span><a name="line-100"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679289178"><a href="#local-6989586621679289178"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">R.Replace</span><span> </span><span class="hs-identifier hs-var">R.Expr</span><span> </span><span class="hs-special">(</span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679289173"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679289177"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">prettyPrint</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">hintRuleRHS</span><span> </span><a href="#local-6989586621679289174"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-identifier">findDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.Type.html#Decl_"><span class="hs-identifier hs-type">Decl_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HSE.Type.html#Decl_"><span class="hs-identifier hs-type">Decl_</span></a><span class="hs-special">]</span><span>
</span><a name="line-103"></a><a name="findDecls"><a href="Hint.Match.html#findDecls"><span class="hs-identifier">findDecls</span></a></a><span> </span><a name="local-6989586621679289179"><a href="#local-6989586621679289179"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">@</span><span class="hs-identifier hs-var">InstDecl</span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">children</span><span> </span><a href="#local-6989586621679289179"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-104"></a><span class="hs-identifier">findDecls</span><span> </span><span class="hs-identifier hs-var">RulePragmaDecl</span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- often rules contain things that HLint would rewrite</span><span>
</span><a name="line-105"></a><span class="hs-identifier">findDecls</span><span> </span><a name="local-6989586621679289180"><a href="#local-6989586621679289180"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679289180"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span class="hs-identifier">matchIdea</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.Scope.html#Scope"><span class="hs-identifier hs-type">Scope</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Type.html#Decl_"><span class="hs-identifier hs-type">Decl_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Config.Type.html#HintRule"><span class="hs-identifier hs-type">HintRule</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Config.Type.html#Note"><span class="hs-identifier hs-type">Note</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">R.SrcSpan</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-108"></a><a name="matchIdea"><a href="Hint.Match.html#matchIdea"><span class="hs-identifier">matchIdea</span></a></a><span> </span><a name="local-6989586621679289181"><a href="#local-6989586621679289181"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679289182"><a href="#local-6989586621679289182"><span class="hs-identifier">decl</span></a></a><span> </span><a href="Config.Type.html#HintRule"><span class="hs-identifier hs-var">HintRule</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679289190"><a href="#local-6989586621679289190"><span class="hs-identifier">parent</span></a></a><span> </span><a name="local-6989586621679289191"><a href="#local-6989586621679289191"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-109"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679289192"><a href="#local-6989586621679289192"><span class="hs-identifier">nm</span></a></a><span> </span><a name="local-6989586621679289193"><a href="#local-6989586621679289193"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679289194"><a href="#local-6989586621679289194"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HSE.Scope.html#scopeMatch"><span class="hs-identifier hs-var">scopeMatch</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679289185"><span class="hs-identifier hs-var">hintRuleScope</span></a><span class="hs-special">,</span><a href="#local-6989586621679289193"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679289181"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><a href="#local-6989586621679289194"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span>    </span><a name="local-6989586621679289195"><a href="#local-6989586621679289195"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HSE.Unify.html#unifyExp"><span class="hs-identifier hs-var">unifyExp</span></a><span> </span><a href="#local-6989586621679289192"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679289186"><span class="hs-identifier hs-var">hintRuleLHS</span></a><span> </span><a href="#local-6989586621679289191"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-111"></a><span>    </span><a name="local-6989586621679289196"><a href="#local-6989586621679289196"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HSE.Unify.html#validSubst"><span class="hs-identifier hs-var">validSubst</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">=~=</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679289195"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-112"></a><span>    </span><span class="hs-comment">-- need to check free vars before unqualification, but after subst (with e)</span><span>
</span><a name="line-113"></a><span>    </span><span class="hs-comment">-- need to unqualify before substitution (with res)</span><span>
</span><a name="line-114"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679289197"><a href="#local-6989586621679289197"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HSE.Unify.html#substitute"><span class="hs-identifier hs-var">substitute</span></a><span> </span><a href="#local-6989586621679289196"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="#local-6989586621679289187"><span class="hs-identifier hs-var">hintRuleRHS</span></a><span>
</span><a name="line-115"></a><span>        </span><a name="local-6989586621679289198"><a href="#local-6989586621679289198"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Hint.Match.html#addBracket"><span class="hs-identifier hs-var">addBracket</span></a><span> </span><a href="#local-6989586621679289190"><span class="hs-identifier hs-var">parent</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Hint.Match.html#performSpecial"><span class="hs-identifier hs-var">performSpecial</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HSE.Unify.html#substitute"><span class="hs-identifier hs-var">substitute</span></a><span> </span><a href="#local-6989586621679289196"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Hint.Match.html#unqualify"><span class="hs-identifier hs-var">unqualify</span></a><span> </span><a href="#local-6989586621679289185"><span class="hs-identifier hs-var">hintRuleScope</span></a><span> </span><a href="#local-6989586621679289181"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679289187"><span class="hs-identifier hs-var">hintRuleRHS</span></a><span>
</span><a name="line-116"></a><span>    </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="HSE.All.html#freeVars"><span class="hs-identifier hs-var">freeVars</span></a><span> </span><a href="#local-6989586621679289197"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">Set.\\</span><span> </span><span class="hs-identifier hs-var">Set.filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Config.Type.html#isUnifyVar"><span class="hs-identifier hs-var">isUnifyVar</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="HSE.All.html#freeVars"><span class="hs-identifier hs-var">freeVars</span></a><span> </span><a href="#local-6989586621679289187"><span class="hs-identifier hs-var">hintRuleRHS</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>            </span><span class="hs-special">`</span><span class="hs-identifier hs-var">Set.isSubsetOf</span><span class="hs-special">`</span><span> </span><a href="HSE.All.html#freeVars"><span class="hs-identifier hs-var">freeVars</span></a><span> </span><a href="#local-6989586621679289191"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-118"></a><span>        </span><span class="hs-comment">-- check no unexpected new free variables</span><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span>    </span><span class="hs-comment">-- check it isn't going to get broken by QuasiQuotes as per #483</span><span>
</span><a name="line-121"></a><span>    </span><span class="hs-comment">-- if we have lambdas we might be moving, and QuasiQuotes, we might inadvertantly break free vars</span><span>
</span><a name="line-122"></a><span>    </span><span class="hs-comment">-- because quasi quotes don't show what free vars they make use of</span><span>
</span><a name="line-123"></a><span>    </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">any</span><span> </span><a href="HSE.Util.html#isLambda"><span class="hs-identifier hs-var">isLambda</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">universe</span><span> </span><a href="#local-6989586621679289186"><span class="hs-identifier hs-var">hintRuleLHS</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">any</span><span> </span><a href="HSE.Util.html#isQuasiQuote"><span class="hs-identifier hs-var">isQuasiQuote</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">universe</span><span> </span><a href="#local-6989586621679289191"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span>    </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Hint.Match.html#checkSide"><span class="hs-identifier hs-var">checkSide</span></a><span> </span><a href="#local-6989586621679289188"><span class="hs-identifier hs-var">hintRuleSide</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;original&quot;</span><span class="hs-special">,</span><a href="#local-6989586621679289191"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;result&quot;</span><span class="hs-special">,</span><a href="#local-6989586621679289198"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="HSE.Unify.html#fromSubst"><span class="hs-identifier hs-var">fromSubst</span></a><span> </span><a href="#local-6989586621679289196"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-126"></a><span>    </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Hint.Match.html#checkDefine"><span class="hs-identifier hs-var">checkDefine</span></a><span> </span><a href="#local-6989586621679289182"><span class="hs-identifier hs-var">decl</span></a><span> </span><a href="#local-6989586621679289190"><span class="hs-identifier hs-var">parent</span></a><span> </span><a href="#local-6989586621679289198"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-127"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679289198"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679289189"><span class="hs-identifier hs-var">hintRuleNotes</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679289199"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679289200"><span class="hs-identifier hs-var">pos</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679289199"><a href="#local-6989586621679289199"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679289200"><a href="#local-6989586621679289200"><span class="hs-identifier">pos</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HSE.Unify.html#fromSubst"><span class="hs-identifier hs-var">fromSubst</span></a><span> </span><a href="#local-6989586621679289196"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ann</span><span> </span><a href="#local-6989586621679289200"><span class="hs-identifier hs-var">pos</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="HSE.Util.html#an"><span class="hs-identifier hs-var">an</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-128"></a><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span class="hs-comment">---------------------------------------------------------------------</span><span>
</span><a name="line-131"></a><span class="hs-comment">-- SIDE CONDITIONS</span><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span class="hs-identifier">checkSide</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-134"></a><a name="checkSide"><a href="Hint.Match.html#checkSide"><span class="hs-identifier">checkSide</span></a></a><span> </span><a name="local-6989586621679289201"><a href="#local-6989586621679289201"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679289202"><a href="#local-6989586621679289202"><span class="hs-identifier">bind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679289203"><span class="hs-identifier hs-var">bool</span></a><span> </span><a href="#local-6989586621679289201"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-135"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-136"></a><span>        </span><span class="hs-identifier">bool</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-137"></a><span>        </span><a name="local-6989586621679289203"><a href="#local-6989586621679289203"><span class="hs-identifier">bool</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixApp</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679289209"><a href="#local-6989586621679289209"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679289210"><a href="#local-6989586621679289210"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621679289211"><a href="#local-6989586621679289211"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="HSE.Util.html#opExp"><span class="hs-identifier hs-var">opExp</span></a><span> </span><a href="#local-6989586621679289210"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="HSE.Match.html#~%3D"><span class="hs-operator hs-var">~=</span></a><span> </span><span class="hs-string">&quot;&amp;&amp;&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679289203"><span class="hs-identifier hs-var">bool</span></a><span> </span><a href="#local-6989586621679289209"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679289203"><span class="hs-identifier hs-var">bool</span></a><span> </span><a href="#local-6989586621679289211"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-139"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="HSE.Util.html#opExp"><span class="hs-identifier hs-var">opExp</span></a><span> </span><a href="#local-6989586621679289210"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="HSE.Match.html#~%3D"><span class="hs-operator hs-var">~=</span></a><span> </span><span class="hs-string">&quot;||&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679289203"><span class="hs-identifier hs-var">bool</span></a><span> </span><a href="#local-6989586621679289209"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679289203"><span class="hs-identifier hs-var">bool</span></a><span> </span><a href="#local-6989586621679289211"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-140"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="HSE.Util.html#opExp"><span class="hs-identifier hs-var">opExp</span></a><span> </span><a href="#local-6989586621679289210"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="HSE.Match.html#~%3D"><span class="hs-operator hs-var">~=</span></a><span> </span><span class="hs-string">&quot;==&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679289204"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-special">(</span><a href="HSE.Util.html#fromParen1"><span class="hs-identifier hs-var">fromParen1</span></a><span> </span><a href="#local-6989586621679289209"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">=~=</span><span> </span><a href="#local-6989586621679289204"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-special">(</span><a href="HSE.Util.html#fromParen1"><span class="hs-identifier hs-var">fromParen1</span></a><span> </span><a href="#local-6989586621679289211"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-141"></a><span>        </span><span class="hs-identifier">bool</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">App</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679289212"><a href="#local-6989586621679289212"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679289213"><a href="#local-6989586621679289213"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679289212"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HSE.Match.html#~%3D"><span class="hs-operator hs-var">~=</span></a><span> </span><span class="hs-string">&quot;not&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679289203"><span class="hs-identifier hs-var">bool</span></a><span> </span><a href="#local-6989586621679289213"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-142"></a><span>        </span><span class="hs-identifier">bool</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Paren</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679289214"><a href="#local-6989586621679289214"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679289203"><span class="hs-identifier hs-var">bool</span></a><span> </span><a href="#local-6989586621679289214"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span>        </span><span class="hs-identifier">bool</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">App</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679289215"><a href="#local-6989586621679289215"><span class="hs-identifier">cond</span></a></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679289208"><span class="hs-identifier hs-var">sub</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a name="local-6989586621679289216"><a href="#local-6989586621679289216"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-145"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-char">'i'</span><span class="hs-glyph">:</span><span class="hs-char">'s'</span><span class="hs-glyph">:</span><a name="local-6989586621679289217"><a href="#local-6989586621679289217"><span class="hs-identifier">typ</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HSE.Match.html#fromNamed"><span class="hs-identifier hs-var">fromNamed</span></a><span> </span><a href="#local-6989586621679289215"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679289205"><span class="hs-identifier hs-var">isType</span></a><span> </span><a href="#local-6989586621679289217"><span class="hs-identifier hs-var">typ</span></a><span> </span><a href="#local-6989586621679289216"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-146"></a><span>        </span><span class="hs-identifier">bool</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">App</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">App</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679289218"><a href="#local-6989586621679289218"><span class="hs-identifier">cond</span></a></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679289208"><span class="hs-identifier hs-var">sub</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a name="local-6989586621679289219"><a href="#local-6989586621679289219"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679289208"><span class="hs-identifier hs-var">sub</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a name="local-6989586621679289220"><a href="#local-6989586621679289220"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679289218"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="HSE.Match.html#~%3D"><span class="hs-operator hs-var">~=</span></a><span> </span><span class="hs-string">&quot;notIn&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">and</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679289221"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">universe</span><span> </span><a href="#local-6989586621679289222"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679289221"><a href="#local-6989586621679289221"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679289207"><span class="hs-identifier hs-var">list</span></a><span> </span><a href="#local-6989586621679289219"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679289222"><a href="#local-6989586621679289222"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679289207"><span class="hs-identifier hs-var">list</span></a><span> </span><a href="#local-6989586621679289220"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">]</span><span>
</span><a name="line-148"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679289218"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="HSE.Match.html#~%3D"><span class="hs-operator hs-var">~=</span></a><span> </span><span class="hs-string">&quot;notEq&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679289219"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HSE.Util.html#%2F%3D~%3D"><span class="hs-operator hs-var">/=~=</span></a><span> </span><a href="#local-6989586621679289220"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-149"></a><span>        </span><span class="hs-identifier">bool</span><span> </span><a name="local-6989586621679289223"><a href="#local-6989586621679289223"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679289223"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HSE.Match.html#~%3D"><span class="hs-operator hs-var">~=</span></a><span> </span><span class="hs-string">&quot;noTypeCheck&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-150"></a><span>        </span><span class="hs-identifier">bool</span><span> </span><a name="local-6989586621679289224"><a href="#local-6989586621679289224"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679289224"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HSE.Match.html#~%3D"><span class="hs-operator hs-var">~=</span></a><span> </span><span class="hs-string">&quot;noQuickCheck&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-151"></a><span>        </span><span class="hs-identifier">bool</span><span> </span><a name="local-6989586621679289225"><a href="#local-6989586621679289225"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Hint.Match.checkSide, unknown side condition: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">prettyPrint</span><span> </span><a href="#local-6989586621679289225"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span>        </span><span class="hs-identifier">expr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span>
</span><a name="line-154"></a><span>        </span><a name="local-6989586621679289204"><a href="#local-6989586621679289204"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">App</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HSE.Match.html#fromNamed"><span class="hs-identifier hs-var">fromNamed</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;subst&quot;</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679289226"><a href="#local-6989586621679289226"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679289208"><span class="hs-identifier hs-var">sub</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HSE.Util.html#fromParen1"><span class="hs-identifier hs-var">fromParen1</span></a><span> </span><a href="#local-6989586621679289226"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-155"></a><span>        </span><span class="hs-identifier">expr</span><span> </span><a name="local-6989586621679289227"><a href="#local-6989586621679289227"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679289227"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span>        </span><a name="local-6989586621679289205"><a href="#local-6989586621679289205"><span class="hs-identifier">isType</span></a></a><span> </span><span class="hs-string">&quot;Compare&quot;</span><span> </span><a name="local-6989586621679289228"><a href="#local-6989586621679289228"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-comment">-- just a hint for proof stuff</span><span>
</span><a name="line-158"></a><span>        </span><span class="hs-identifier">isType</span><span> </span><span class="hs-string">&quot;Atom&quot;</span><span> </span><a name="local-6989586621679289229"><a href="#local-6989586621679289229"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isAtom</span><span> </span><a href="#local-6989586621679289229"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-159"></a><span>        </span><span class="hs-identifier">isType</span><span> </span><span class="hs-string">&quot;WHNF&quot;</span><span> </span><a name="local-6989586621679289230"><a href="#local-6989586621679289230"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HSE.Util.html#isWHNF"><span class="hs-identifier hs-var">isWHNF</span></a><span> </span><a href="#local-6989586621679289230"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-160"></a><span>        </span><span class="hs-identifier">isType</span><span> </span><span class="hs-string">&quot;Wildcard&quot;</span><span> </span><a name="local-6989586621679289231"><a href="#local-6989586621679289231"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><a href="HSE.Util.html#isFieldWildcard"><span class="hs-identifier hs-var">isFieldWildcard</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HSE.Util.html#universeS"><span class="hs-identifier hs-var">universeS</span></a><span> </span><a href="#local-6989586621679289231"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-161"></a><span>        </span><span class="hs-identifier">isType</span><span> </span><span class="hs-string">&quot;Nat&quot;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679289206"><span class="hs-identifier hs-var">asInt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679289232"><a href="#local-6989586621679289232"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679289232"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-162"></a><span>        </span><span class="hs-identifier">isType</span><span> </span><span class="hs-string">&quot;Pos&quot;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679289206"><span class="hs-identifier hs-var">asInt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679289233"><a href="#local-6989586621679289233"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679289233"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span>  </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-163"></a><span>        </span><span class="hs-identifier">isType</span><span> </span><span class="hs-string">&quot;Neg&quot;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679289206"><span class="hs-identifier hs-var">asInt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679289234"><a href="#local-6989586621679289234"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679289234"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span>  </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-164"></a><span>        </span><span class="hs-identifier">isType</span><span> </span><span class="hs-string">&quot;NegZero&quot;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679289206"><span class="hs-identifier hs-var">asInt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679289235"><a href="#local-6989586621679289235"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679289235"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-165"></a><span>        </span><span class="hs-identifier">isType</span><span> </span><span class="hs-special">(</span><span class="hs-char">'L'</span><span class="hs-glyph">:</span><span class="hs-char">'i'</span><span class="hs-glyph">:</span><span class="hs-char">'t'</span><span class="hs-glyph">:</span><a name="local-6989586621679289236"><a href="#local-6989586621679289236"><span class="hs-identifier">typ</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Lit</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679289237"><a href="#local-6989586621679289237"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">words</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679289237"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679289236"><span class="hs-identifier hs-var">typ</span></a><span>
</span><a name="line-166"></a><span>        </span><span class="hs-identifier">isType</span><span> </span><a name="local-6989586621679289238"><a href="#local-6989586621679289238"><span class="hs-identifier">typ</span></a></a><span> </span><a name="local-6989586621679289239"><a href="#local-6989586621679289239"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">words</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679289239"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679289238"><span class="hs-identifier hs-var">typ</span></a><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span>        </span><span class="hs-identifier">asInt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-169"></a><span>        </span><a name="local-6989586621679289206"><a href="#local-6989586621679289206"><span class="hs-identifier">asInt</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Paren</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679289240"><a href="#local-6989586621679289240"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679289206"><span class="hs-identifier hs-var">asInt</span></a><span> </span><a href="#local-6989586621679289240"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-170"></a><span>        </span><span class="hs-identifier">asInt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NegApp</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679289241"><a href="#local-6989586621679289241"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">negate</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679289206"><span class="hs-identifier hs-var">asInt</span></a><span> </span><a href="#local-6989586621679289241"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-171"></a><span>        </span><span class="hs-identifier">asInt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Lit</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Int</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679289242"><a href="#local-6989586621679289242"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679289242"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-172"></a><span>        </span><span class="hs-identifier">asInt</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span>        </span><span class="hs-identifier">list</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span class="hs-special">]</span><span>
</span><a name="line-175"></a><span>        </span><a name="local-6989586621679289207"><a href="#local-6989586621679289207"><span class="hs-identifier">list</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">List</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679289243"><a href="#local-6989586621679289243"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679289243"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-176"></a><span>        </span><span class="hs-identifier">list</span><span> </span><a name="local-6989586621679289244"><a href="#local-6989586621679289244"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679289244"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span>        </span><span class="hs-identifier">sub</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span>
</span><a name="line-179"></a><span>        </span><a name="local-6989586621679289208"><a href="#local-6989586621679289208"><span class="hs-identifier">sub</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">transform</span><span> </span><a href="#local-6989586621679289245"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-180"></a><span>            </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679289245"><a href="#local-6989586621679289245"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="HSE.Match.html#view"><span class="hs-identifier hs-var">view</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Match.html#Var_"><span class="hs-identifier hs-var">Var_</span></a><span> </span><a name="local-6989586621679289246"><a href="#local-6989586621679289246"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679289247"><a href="#local-6989586621679289247"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lookup</span><span> </span><a href="#local-6989586621679289246"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679289202"><span class="hs-identifier hs-var">bind</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679289247"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-181"></a><span>                  </span><span class="hs-identifier">f</span><span> </span><a name="local-6989586621679289248"><a href="#local-6989586621679289248"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679289248"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span class="hs-comment">-- does the result look very much like the declaration</span><span>
</span><a name="line-185"></a><span class="hs-identifier">checkDefine</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.Type.html#Decl_"><span class="hs-identifier hs-type">Decl_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-186"></a><a name="checkDefine"><a href="Hint.Match.html#checkDefine"><span class="hs-identifier">checkDefine</span></a></a><span> </span><a name="local-6989586621679289249"><a href="#local-6989586621679289249"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a name="local-6989586621679289250"><a href="#local-6989586621679289250"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HSE.Match.html#fromNamed"><span class="hs-identifier hs-var">fromNamed</span></a><span> </span><a href="#local-6989586621679289249"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="HSE.Match.html#fromNamed"><span class="hs-identifier hs-var">fromNamed</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">transformBi</span><span> </span><a href="HSE.Util.html#unqual"><span class="hs-identifier hs-var">unqual</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HSE.Util.html#fromApps"><span class="hs-identifier hs-var">fromApps</span></a><span> </span><a href="#local-6989586621679289250"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span class="hs-identifier">checkDefine</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-188"></a><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span class="hs-comment">---------------------------------------------------------------------</span><span>
</span><a name="line-191"></a><span class="hs-comment">-- TRANSFORMATION</span><span>
</span><a name="line-192"></a><span>
</span><a name="line-193"></a><span class="hs-comment">-- if it has _eval_ do evaluation on it</span><span>
</span><a name="line-194"></a><span class="hs-identifier">performSpecial</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span>
</span><a name="line-195"></a><a name="performSpecial"><a href="Hint.Match.html#performSpecial"><span class="hs-identifier">performSpecial</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">transform</span><span> </span><a href="#local-6989586621679289252"><span class="hs-identifier hs-var">fNoParen</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679289251"><span class="hs-identifier hs-var">fEval</span></a><span>
</span><a name="line-196"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-197"></a><span>        </span><a name="local-6989586621679289251"><a href="#local-6989586621679289251"><span class="hs-identifier">fEval</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">App</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679289253"><a href="#local-6989586621679289253"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679289254"><a href="#local-6989586621679289254"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679289253"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="HSE.Match.html#~%3D"><span class="hs-operator hs-var">~=</span></a><span> </span><span class="hs-string">&quot;_eval_&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HSE.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a><span> </span><a href="#local-6989586621679289254"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-198"></a><span>        </span><span class="hs-identifier">fEval</span><span> </span><a name="local-6989586621679289255"><a href="#local-6989586621679289255"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679289255"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span>        </span><a name="local-6989586621679289252"><a href="#local-6989586621679289252"><span class="hs-identifier">fNoParen</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">App</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679289256"><a href="#local-6989586621679289256"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679289257"><a href="#local-6989586621679289257"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679289256"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="HSE.Match.html#~%3D"><span class="hs-operator hs-var">~=</span></a><span> </span><span class="hs-string">&quot;_noParen_&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HSE.Util.html#fromParen"><span class="hs-identifier hs-var">fromParen</span></a><span> </span><a href="#local-6989586621679289257"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-201"></a><span>        </span><span class="hs-identifier">fNoParen</span><span> </span><a name="local-6989586621679289258"><a href="#local-6989586621679289258"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679289258"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span class="hs-comment">-- contract Data.List.foo ==&gt; foo, if Data.List is loaded</span><span>
</span><a name="line-204"></a><span class="hs-identifier">unqualify</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.Scope.html#Scope"><span class="hs-identifier hs-type">Scope</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Scope.html#Scope"><span class="hs-identifier hs-type">Scope</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span>
</span><a name="line-205"></a><a name="unqualify"><a href="Hint.Match.html#unqualify"><span class="hs-identifier">unqualify</span></a></a><span> </span><a name="local-6989586621679289259"><a href="#local-6989586621679289259"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621679289260"><a href="#local-6989586621679289260"><span class="hs-identifier">to</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">transformBi</span><span> </span><a href="#local-6989586621679289261"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-206"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-207"></a><span>        </span><a name="local-6989586621679289261"><a href="#local-6989586621679289261"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679289262"><a href="#local-6989586621679289262"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">UnQual</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Ident</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679289263"><a href="#local-6989586621679289263"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Config.Type.html#isUnifyVar"><span class="hs-identifier hs-var">isUnifyVar</span></a><span> </span><a href="#local-6989586621679289263"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679289262"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-208"></a><span>        </span><span class="hs-identifier">f</span><span> </span><a name="local-6989586621679289264"><a href="#local-6989586621679289264"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HSE.Scope.html#scopeMove"><span class="hs-identifier hs-var">scopeMove</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679289259"><span class="hs-identifier hs-var">from</span></a><span class="hs-special">,</span><a href="#local-6989586621679289264"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679289260"><span class="hs-identifier hs-var">to</span></a><span>
</span><a name="line-209"></a><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span class="hs-identifier">addBracket</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span>
</span><a name="line-212"></a><a name="addBracket"><a href="Hint.Match.html#addBracket"><span class="hs-identifier">addBracket</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679289265"><a href="#local-6989586621679289265"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679289266"><a href="#local-6989586621679289266"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679289267"><a href="#local-6989586621679289267"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="HSE.Util.html#needBracketOld"><span class="hs-identifier hs-var">needBracketOld</span></a><span> </span><a href="#local-6989586621679289265"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679289266"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679289267"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Paren</span><span> </span><a href="HSE.Util.html#an"><span class="hs-identifier hs-var">an</span></a><span> </span><a href="#local-6989586621679289267"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-213"></a><span class="hs-identifier">addBracket</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679289268"><a href="#local-6989586621679289268"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679289268"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-214"></a></pre></body></html>