<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ViewPatterns, ScopedTypeVariables #-}</span><span>
</span><a name="line-2"></a><span class="hs-comment">{-
Raise an error if you are bracketing an atom, or are enclosed be a list bracket

&lt;TEST&gt;
-- expression bracket reduction
yes = (f x) x -- @Suggestion f x x
no = f (x x)
yes = (foo) -- foo
yes = (foo bar) -- @Suggestion foo bar
yes = foo (bar) -- @Warning bar
yes = foo ((x x)) -- @Suggestion (x x)
yes = (f x) ||| y -- @Suggestion f x ||| y
yes = if (f x) then y else z -- @Suggestion if f x then y else z
yes = if x then (f y) else z -- @Suggestion if x then f y else z
yes = (a foo) :: Int -- @Suggestion a foo :: Int
yes = [(foo bar)] -- @Suggestion [foo bar]
yes = foo ((x y), z) -- @Suggestion (x y, z)
yes = C { f = (e h) } -- @Suggestion C {f = e h}
yes = \ x -&gt; (x &amp;&amp; x) -- @Suggestion \x -&gt; x &amp;&amp; x
no = \(x -&gt; y) -&gt; z
yes = (`foo` (bar baz)) -- @Suggestion (`foo` bar baz)
yes = f ((x)) -- @Warning x
main = do f; (print x) -- @Suggestion do f print x
yes = f (x) y -- @Warning x
no = f (+x) y
no = f ($x) y
no = ($x)
yes = (($x))
no = ($1)
yes = (($1)) -- @Warning ($1)
no = (+5)
yes = ((+5)) -- @Warning (+5)

-- type bracket reduction
foo :: (Int -&gt; Int) -&gt; Int
foo :: (Maybe Int) -&gt; a -- @Suggestion Maybe Int -&gt; a
instance Named (DeclHead S)
data Foo = Foo {foo :: (Maybe Foo)} -- @Suggestion foo :: Maybe Foo

-- pattern bracket reduction
foo (x:xs) = 1
foo (True) = 1 -- @Warning True
foo ((True)) = 1 -- @Warning True
foo (A{}) = True -- A{}
f x = case x of (Nothing) -&gt; 1; _ -&gt; 2 -- Nothing

-- dollar reduction tests
no = groupFsts . sortFst $ mr
yes = split &quot;to&quot; $ names -- split &quot;to&quot; names
yes = white $ keysymbol -- white keysymbol
yes = operator foo $ operator -- operator foo operator
no = operator foo $ operator bar
yes = return $ Record{a=b}

-- $/bracket rotation tests
yes = (b $ c d) ++ e -- b (c d) ++ e
yes = (a b $ c d) ++ e -- a b (c d) ++ e
no = (f . g $ a) ++ e
no = quickCheck ((\h -&gt; cySucc h == succ h) :: Hygiene -&gt; Bool)
foo = (case x of y -&gt; z; q -&gt; w) :: Int

-- backup fixity resolution
main = do a += b . c; return $ a . b

-- &lt;$&gt; bracket tests
yes = (foo . bar x) &lt;$&gt; baz q -- foo . bar x &lt;$&gt; baz q
no = foo . bar x &lt;$&gt; baz q

-- annotations
main = 1; {-# ANN module (&quot;HLint: ignore Use camelCase&quot; :: String) #-}
main = 1; {-# ANN module (1 + (2)) #-} -- 2

-- special case from esqueleto, see #224
main = operate &lt;$&gt; (select $ from $ \user -&gt; return $ user ^. UserEmail)
-- unknown fixity, see #426
bad x = x . (x +? x . x)
-- special case people don't like to warn on
special = foo $ f{x=1}
special = foo $ Rec{x=1}
special = foo (f{x=1})
&lt;/TEST&gt;
-}</span><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hint.Bracket</span><span class="hs-special">(</span><a href="Hint.Bracket.html#bracketHint"><span class="hs-identifier hs-var">bracketHint</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><a href="Hint.Type.html"><span class="hs-identifier">Hint.Type</span></a><span>
</span><a name="line-89"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Data</span><span>
</span><a name="line-90"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Refact.Types</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span class="hs-identifier">bracketHint</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Hint.Type.html#DeclHint"><span class="hs-identifier hs-type">DeclHint</span></a><span>
</span><a name="line-94"></a><a name="bracketHint"><a href="Hint.Bracket.html#bracketHint"><span class="hs-identifier">bracketHint</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679283592"><a href="#local-6989586621679283592"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-95"></a><span>    </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679283597"><a href="#local-6989586621679283597"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Hint.Bracket.html#bracket"><span class="hs-identifier hs-var">bracket</span></a><span> </span><a href="Hint.Bracket.html#isPartialAtom"><span class="hs-identifier hs-var">isPartialAtom</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679283597"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Hint.Bracket.html#dollar"><span class="hs-identifier hs-var">dollar</span></a><span> </span><a href="#local-6989586621679283597"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">childrenBi</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">descendBi</span><span> </span><a href="#local-6989586621679283593"><span class="hs-identifier hs-var">annotations</span></a><span> </span><a href="#local-6989586621679283592"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-96"></a><span>    </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><a href="Hint.Bracket.html#bracket"><span class="hs-identifier hs-var">bracket</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">childrenBi</span><span> </span><a href="#local-6989586621679283592"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HSE.Type.html#Type_"><span class="hs-identifier hs-type">Type_</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-97"></a><span>    </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><a href="Hint.Bracket.html#bracket"><span class="hs-identifier hs-var">bracket</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">childrenBi</span><span> </span><a href="#local-6989586621679283592"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HSE.Type.html#Pat_"><span class="hs-identifier hs-type">Pat_</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-98"></a><span>    </span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="Hint.Bracket.html#fieldDecl"><span class="hs-identifier hs-var">fieldDecl</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">childrenBi</span><span> </span><a href="#local-6989586621679283592"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-99"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-100"></a><span>        </span><span class="hs-comment">-- Brackets at the roots of annotations are fine, so we strip them</span><span>
</span><a name="line-101"></a><span>        </span><span class="hs-identifier">annotations</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Annotation</span><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Annotation</span><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span>
</span><a name="line-102"></a><span>        </span><a name="local-6989586621679283593"><a href="#local-6989586621679283593"><span class="hs-identifier">annotations</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">descendBi</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679283594"><a href="#local-6989586621679283594"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679283594"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-103"></a><span>            </span><span class="hs-identifier hs-var">Paren</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679283595"><a href="#local-6989586621679283595"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679283595"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-104"></a><span>            </span><a name="local-6989586621679283596"><a href="#local-6989586621679283596"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679283596"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-identifier">isPartialAtom</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-107"></a><a name="isPartialAtom"><a href="Hint.Bracket.html#isPartialAtom"><span class="hs-identifier">isPartialAtom</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SpliceExp</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">IdSplice</span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-comment">-- might be $x, which was really $ x, but TH enabled misparsed it</span><span>
</span><a name="line-108"></a><span class="hs-identifier">isPartialAtom</span><span> </span><a name="local-6989586621679283598"><a href="#local-6989586621679283598"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HSE.Util.html#isRecConstr"><span class="hs-identifier hs-var">isRecConstr</span></a><span> </span><a href="#local-6989586621679283598"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="HSE.Util.html#isRecUpdate"><span class="hs-identifier hs-var">isRecUpdate</span></a><span> </span><a href="#local-6989586621679283598"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-comment">-- Dirty, should add to Brackets type class I think</span><span>
</span><a name="line-111"></a><span class="hs-identifier">tyConToRtype</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RType</span><span>
</span><a name="line-112"></a><a name="tyConToRtype"><a href="Hint.Bracket.html#tyConToRtype"><span class="hs-identifier">tyConToRtype</span></a></a><span> </span><span class="hs-string">&quot;Exp&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Expr</span><span>
</span><a name="line-113"></a><span class="hs-identifier">tyConToRtype</span><span> </span><span class="hs-string">&quot;Type&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Type</span><span>
</span><a name="line-114"></a><span class="hs-identifier">tyConToRtype</span><span> </span><span class="hs-string">&quot;Pat&quot;</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Pattern</span><span>
</span><a name="line-115"></a><span class="hs-identifier">tyConToRtype</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Expr</span><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-identifier">findType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Data</span><span> </span><a href="#local-6989586621679283591"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679283591"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RType</span><span>
</span><a name="line-118"></a><a name="findType"><a href="Hint.Bracket.html#findType"><span class="hs-identifier">findType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Hint.Bracket.html#tyConToRtype"><span class="hs-identifier hs-var">tyConToRtype</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">dataTypeName</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">dataTypeOf</span><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-comment">-- Just if at least one paren was removed</span><span>
</span><a name="line-121"></a><span class="hs-comment">-- Nothing if zero parens were removed</span><span>
</span><a name="line-122"></a><span class="hs-identifier">remParens</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Brackets</span><span> </span><a href="#local-6989586621679283590"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679283590"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679283590"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-123"></a><a name="remParens"><a href="Hint.Bracket.html#remParens"><span class="hs-identifier">remParens</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679283599"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">remParen</span><span>
</span><a name="line-124"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-125"></a><span>    </span><a name="local-6989586621679283599"><a href="#local-6989586621679283599"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679283600"><a href="#local-6989586621679283600"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><a href="#local-6989586621679283600"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621679283599"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">remParen</span><span> </span><a href="#local-6989586621679283600"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-identifier">bracket</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679283589"><a href="#local-6989586621679283589"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Data</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ExactP</span><span> </span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Pretty</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Brackets</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Idea.html#Idea"><span class="hs-identifier hs-type">Idea</span></a><span class="hs-special">]</span><span>
</span><a name="line-128"></a><a name="bracket"><a href="Hint.Bracket.html#bracket"><span class="hs-identifier">bracket</span></a></a><span> </span><a name="local-6989586621679283601"><a href="#local-6989586621679283601"><span class="hs-identifier">isPartialAtom</span></a></a><span> </span><a name="local-6989586621679283602"><a href="#local-6989586621679283602"><span class="hs-identifier">root</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679283604"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-129"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-130"></a><span>        </span><a name="local-6989586621679283603"><a href="#local-6989586621679283603"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Redundant bracket&quot;</span><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span>        </span><span class="hs-comment">-- f (Maybe (index, parent, gen)) child</span><span>
</span><a name="line-133"></a><span>        </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Data</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ExactP</span><span> </span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Pretty</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Brackets</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">,</span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Idea.html#Idea"><span class="hs-identifier hs-type">Idea</span></a><span class="hs-special">]</span><span>
</span><a name="line-134"></a><span>        </span><a name="local-6989586621679283604"><a href="#local-6989586621679283604"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-identifier hs-var">Just</span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679283606"><a href="#local-6989586621679283606"><span class="hs-identifier">o</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Hint.Bracket.html#remParens"><span class="hs-identifier hs-var">remParens</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679283607"><a href="#local-6989586621679283607"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isAtom</span><span> </span><a href="#local-6989586621679283607"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679283601"><span class="hs-identifier hs-var">isPartialAtom</span></a><span> </span><a href="#local-6989586621679283607"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Hint.Bracket.html#bracketError"><span class="hs-identifier hs-var">bracketError</span></a><span> </span><a href="#local-6989586621679283603"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="#local-6989586621679283606"><span class="hs-identifier hs-var">o</span></a><span> </span><a href="#local-6989586621679283607"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679283605"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621679283607"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-135"></a><span>        </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a name="local-6989586621679283608"><a href="#local-6989586621679283608"><span class="hs-identifier">o</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Hint.Bracket.html#remParens"><span class="hs-identifier hs-var">remParens</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679283609"><a href="#local-6989586621679283609"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679283602"><span class="hs-identifier hs-var">root</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">isAtom</span><span> </span><a href="#local-6989586621679283609"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679283601"><span class="hs-identifier hs-var">isPartialAtom</span></a><span> </span><a href="#local-6989586621679283609"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">isAtom</span><span> </span><a href="#local-6989586621679283609"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Hint.Bracket.html#bracketError"><span class="hs-identifier hs-var">bracketError</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Hint.Bracket.html#bracketWarning"><span class="hs-identifier hs-var">bracketWarning</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679283603"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="#local-6989586621679283608"><span class="hs-identifier hs-var">o</span></a><span> </span><a href="#local-6989586621679283609"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679283605"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621679283609"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-136"></a><span>        </span><span class="hs-identifier">f</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679283610"><a href="#local-6989586621679283610"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679283611"><a href="#local-6989586621679283611"><span class="hs-identifier">o</span></a></a><span class="hs-special">,</span><a name="local-6989586621679283612"><a href="#local-6989586621679283612"><span class="hs-identifier">gen</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679283613"><a href="#local-6989586621679283613"><span class="hs-identifier">v</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Hint.Bracket.html#remParens"><span class="hs-identifier hs-var">remParens</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679283614"><a href="#local-6989586621679283614"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">needBracket</span><span> </span><a href="#local-6989586621679283610"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679283611"><span class="hs-identifier hs-var">o</span></a><span> </span><a href="#local-6989586621679283614"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679283601"><span class="hs-identifier hs-var">isPartialAtom</span></a><span> </span><a href="#local-6989586621679283614"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-137"></a><span>          </span><a href="Idea.html#suggest"><span class="hs-identifier hs-var">suggest</span></a><span> </span><a href="#local-6989586621679283603"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="#local-6989586621679283611"><span class="hs-identifier hs-var">o</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679283612"><span class="hs-identifier hs-var">gen</span></a><span> </span><a href="#local-6989586621679283614"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679283616"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679283605"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621679283614"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-138"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-139"></a><span>            </span><a name="local-6989586621679283615"><a href="#local-6989586621679283615"><span class="hs-identifier">typ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Hint.Bracket.html#findType"><span class="hs-identifier hs-var">findType</span></a><span> </span><a href="#local-6989586621679283613"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-140"></a><span>            </span><a name="local-6989586621679283616"><a href="#local-6989586621679283616"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Replace</span><span> </span><a href="#local-6989586621679283615"><span class="hs-identifier hs-var">typ</span></a><span> </span><span class="hs-special">(</span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679283613"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-string">&quot;x&quot;</span><span class="hs-special">,</span><span> </span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679283614"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-string">&quot;x&quot;</span><span>
</span><a name="line-141"></a><span>        </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679283617"><a href="#local-6989586621679283617"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679283605"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621679283617"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-142"></a><span>
</span><a name="line-143"></a><span>        </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Data</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ExactP</span><span> </span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Pretty</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Brackets</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679283589"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Idea.html#Idea"><span class="hs-identifier hs-type">Idea</span></a><span class="hs-special">]</span><span>
</span><a name="line-144"></a><span>        </span><a name="local-6989586621679283605"><a href="#local-6989586621679283605"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-6989586621679283618"><a href="#local-6989586621679283618"><span class="hs-identifier">o</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679283604"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679283619"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679283618"><span class="hs-identifier hs-var">o</span></a><span class="hs-special">,</span><a href="#local-6989586621679283621"><span class="hs-identifier hs-var">gen</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679283620"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679283619"><a href="#local-6989586621679283619"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span class="hs-special">(</span><a name="local-6989586621679283620"><a href="#local-6989586621679283620"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679283621"><a href="#local-6989586621679283621"><span class="hs-identifier">gen</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">holes</span><span> </span><a href="#local-6989586621679283618"><span class="hs-identifier hs-var">o</span></a><span class="hs-special">]</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><a name="bracketWarning"><a href="Hint.Bracket.html#bracketWarning"><span class="hs-identifier">bracketWarning</span></a></a><span> </span><a name="local-6989586621679283622"><a href="#local-6989586621679283622"><span class="hs-identifier">msg</span></a></a><span> </span><a name="local-6989586621679283623"><a href="#local-6989586621679283623"><span class="hs-identifier">o</span></a></a><span> </span><a name="local-6989586621679283624"><a href="#local-6989586621679283624"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-147"></a><span>  </span><a href="Idea.html#suggest"><span class="hs-identifier hs-var">suggest</span></a><span> </span><a href="#local-6989586621679283622"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="#local-6989586621679283623"><span class="hs-identifier hs-var">o</span></a><span> </span><a href="#local-6989586621679283624"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">Replace</span><span> </span><span class="hs-special">(</span><a href="Hint.Bracket.html#findType"><span class="hs-identifier hs-var">findType</span></a><span> </span><a href="#local-6989586621679283624"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679283623"><span class="hs-identifier hs-var">o</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-string">&quot;x&quot;</span><span class="hs-special">,</span><span> </span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679283624"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-string">&quot;x&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-148"></a><a name="bracketError"><a href="Hint.Bracket.html#bracketError"><span class="hs-identifier">bracketError</span></a></a><span> </span><a name="local-6989586621679283625"><a href="#local-6989586621679283625"><span class="hs-identifier">msg</span></a></a><span> </span><a name="local-6989586621679283626"><a href="#local-6989586621679283626"><span class="hs-identifier">o</span></a></a><span> </span><a name="local-6989586621679283627"><a href="#local-6989586621679283627"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-149"></a><span>  </span><a href="Idea.html#warn"><span class="hs-identifier hs-var">warn</span></a><span> </span><a href="#local-6989586621679283625"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="#local-6989586621679283626"><span class="hs-identifier hs-var">o</span></a><span> </span><a href="#local-6989586621679283627"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">Replace</span><span> </span><span class="hs-special">(</span><a href="Hint.Bracket.html#findType"><span class="hs-identifier hs-var">findType</span></a><span> </span><a href="#local-6989586621679283627"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679283626"><span class="hs-identifier hs-var">o</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-string">&quot;x&quot;</span><span class="hs-special">,</span><span> </span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679283627"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-string">&quot;x&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-identifier">fieldDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FieldDecl</span><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Idea.html#Idea"><span class="hs-identifier hs-type">Idea</span></a><span class="hs-special">]</span><span>
</span><a name="line-153"></a><a name="fieldDecl"><a href="Hint.Bracket.html#fieldDecl"><span class="hs-identifier">fieldDecl</span></a></a><span> </span><a name="local-6989586621679283628"><a href="#local-6989586621679283628"><span class="hs-identifier">o</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">FieldDecl</span><span> </span><a name="local-6989586621679283629"><a href="#local-6989586621679283629"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679283630"><a href="#local-6989586621679283630"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679283631"><a href="#local-6989586621679283631"><span class="hs-identifier">v</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">TyParen</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679283632"><a href="#local-6989586621679283632"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-154"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Idea.html#suggest"><span class="hs-identifier hs-var">suggest</span></a><span> </span><span class="hs-string">&quot;Redundant bracket&quot;</span><span> </span><a href="#local-6989586621679283628"><span class="hs-identifier hs-var">o</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FieldDecl</span><span> </span><a href="#local-6989586621679283629"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679283630"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679283632"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>  </span><span class="hs-special">[</span><span class="hs-identifier hs-var">Replace</span><span> </span><span class="hs-identifier hs-var">Type</span><span> </span><span class="hs-special">(</span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679283631"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-string">&quot;x&quot;</span><span class="hs-special">,</span><span> </span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679283632"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-string">&quot;x&quot;</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-155"></a><span class="hs-identifier">fieldDecl</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span class="hs-identifier">dollar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Idea.html#Idea"><span class="hs-identifier hs-type">Idea</span></a><span class="hs-special">]</span><span>
</span><a name="line-159"></a><a name="dollar"><a href="Hint.Bracket.html#dollar"><span class="hs-identifier">dollar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="#local-6989586621679283633"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">universe</span><span>
</span><a name="line-160"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-161"></a><span>        </span><a name="local-6989586621679283633"><a href="#local-6989586621679283633"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679283634"><a href="#local-6989586621679283634"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Idea.html#suggest"><span class="hs-identifier hs-var">suggest</span></a><span> </span><span class="hs-string">&quot;Redundant $&quot;</span><span> </span><a href="#local-6989586621679283634"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679283638"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679283639"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">InfixApp</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679283635"><a href="#local-6989586621679283635"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679283636"><a href="#local-6989586621679283636"><span class="hs-identifier">d</span></a></a><span> </span><a name="local-6989586621679283637"><a href="#local-6989586621679283637"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679283634"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="HSE.Util.html#opExp"><span class="hs-identifier hs-var">opExp</span></a><span> </span><a href="#local-6989586621679283636"><span class="hs-identifier hs-var">d</span></a><span> </span><a href="HSE.Match.html#~%3D"><span class="hs-operator hs-var">~=</span></a><span> </span><span class="hs-string">&quot;$&quot;</span><span>
</span><a name="line-162"></a><span>              </span><span class="hs-special">,</span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679283638"><a href="#local-6989586621679283638"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">App</span><span> </span><a href="HSE.Util.html#an"><span class="hs-identifier hs-var">an</span></a><span> </span><a href="#local-6989586621679283635"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679283637"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">needBracket</span><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679283638"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621679283635"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">needBracket</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679283638"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621679283637"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Hint.Bracket.html#isPartialAtom"><span class="hs-identifier hs-var">isPartialAtom</span></a><span> </span><a href="#local-6989586621679283637"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-163"></a><span>              </span><span class="hs-special">,</span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679283639"><a href="#local-6989586621679283639"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Replace</span><span> </span><span class="hs-identifier hs-var">Expr</span><span> </span><span class="hs-special">(</span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679283634"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-string">&quot;a&quot;</span><span class="hs-special">,</span><span> </span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679283635"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;b&quot;</span><span class="hs-special">,</span><span> </span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679283637"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-string">&quot;a b&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-164"></a><span>              </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-165"></a><span>              </span><span class="hs-special">[</span><a href="Idea.html#suggest"><span class="hs-identifier hs-var">suggest</span></a><span> </span><span class="hs-string">&quot;Move brackets to avoid $&quot;</span><span> </span><a href="#local-6989586621679283634"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679283640"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621679283645"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679283646"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">(</span><a name="local-6989586621679283640"><a href="#local-6989586621679283640"><span class="hs-identifier">t</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679283641"><a href="#local-6989586621679283641"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Paren</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixApp</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679283642"><a href="#local-6989586621679283642"><span class="hs-identifier">a1</span></a></a><span> </span><a name="local-6989586621679283643"><a href="#local-6989586621679283643"><span class="hs-identifier">op1</span></a></a><span> </span><a name="local-6989586621679283644"><a href="#local-6989586621679283644"><span class="hs-identifier">a2</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Hint.Bracket.html#splitInfix"><span class="hs-identifier hs-var">splitInfix</span></a><span> </span><a href="#local-6989586621679283634"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-166"></a><span>              </span><span class="hs-special">,</span><a href="HSE.Util.html#opExp"><span class="hs-identifier hs-var">opExp</span></a><span> </span><a href="#local-6989586621679283643"><span class="hs-identifier hs-var">op1</span></a><span> </span><a href="HSE.Match.html#~%3D"><span class="hs-operator hs-var">~=</span></a><span> </span><span class="hs-string">&quot;$&quot;</span><span class="hs-special">,</span><span> </span><a href="HSE.Util.html#isVar"><span class="hs-identifier hs-var">isVar</span></a><span> </span><a href="#local-6989586621679283642"><span class="hs-identifier hs-var">a1</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="HSE.Util.html#isApp"><span class="hs-identifier hs-var">isApp</span></a><span> </span><a href="#local-6989586621679283642"><span class="hs-identifier hs-var">a1</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="HSE.Util.html#isParen"><span class="hs-identifier hs-var">isParen</span></a><span> </span><a href="#local-6989586621679283642"><span class="hs-identifier hs-var">a1</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">isAtom</span><span> </span><a href="#local-6989586621679283644"><span class="hs-identifier hs-var">a2</span></a><span>
</span><a name="line-167"></a><span>              </span><span class="hs-special">,</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679283642"><span class="hs-identifier hs-var">a1</span></a><span> </span><a href="HSE.Match.html#~%3D"><span class="hs-operator hs-var">~=</span></a><span> </span><span class="hs-string">&quot;select&quot;</span><span> </span><span class="hs-comment">-- special case for esqueleto, see #224</span><span>
</span><a name="line-168"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679283645"><a href="#local-6989586621679283645"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">App</span><span> </span><a href="HSE.Util.html#an"><span class="hs-identifier hs-var">an</span></a><span> </span><a href="#local-6989586621679283642"><span class="hs-identifier hs-var">a1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Paren</span><span> </span><a href="HSE.Util.html#an"><span class="hs-identifier hs-var">an</span></a><span> </span><a href="#local-6989586621679283644"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">)</span><span>
</span><a name="line-169"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679283646"><a href="#local-6989586621679283646"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Replace</span><span> </span><span class="hs-identifier hs-var">Expr</span><span> </span><span class="hs-special">(</span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679283641"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-string">&quot;a&quot;</span><span class="hs-special">,</span><span> </span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679283642"><span class="hs-identifier hs-var">a1</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;b&quot;</span><span class="hs-special">,</span><span> </span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679283644"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-string">&quot;a (b)&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-170"></a><span>              </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-171"></a><span>              </span><span class="hs-comment">-- special case of (v1 . v2) &lt;$&gt; v3</span><span>
</span><a name="line-172"></a><span>              </span><span class="hs-special">[</span><a href="Idea.html#suggest"><span class="hs-identifier hs-var">suggest</span></a><span> </span><span class="hs-string">&quot;Redundant bracket&quot;</span><span> </span><a href="#local-6989586621679283634"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679283652"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-173"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">InfixApp</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Paren</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679283647"><a href="#local-6989586621679283647"><span class="hs-identifier">o1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixApp</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679283648"><a href="#local-6989586621679283648"><span class="hs-identifier">v1</span></a></a><span> </span><span class="hs-special">(</span><a href="HSE.Util.html#isDot"><span class="hs-identifier hs-var">isDot</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679283649"><a href="#local-6989586621679283649"><span class="hs-identifier">v2</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679283650"><a href="#local-6989586621679283650"><span class="hs-identifier">o2</span></a></a><span> </span><a name="local-6989586621679283651"><a href="#local-6989586621679283651"><span class="hs-identifier">v3</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679283634"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="HSE.Util.html#opExp"><span class="hs-identifier hs-var">opExp</span></a><span> </span><a href="#local-6989586621679283650"><span class="hs-identifier hs-var">o2</span></a><span> </span><a href="HSE.Match.html#~%3D"><span class="hs-operator hs-var">~=</span></a><span> </span><span class="hs-string">&quot;&lt;$&gt;&quot;</span><span>
</span><a name="line-174"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679283652"><a href="#local-6989586621679283652"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">InfixApp</span><span> </span><a href="HSE.Util.html#an"><span class="hs-identifier hs-var">an</span></a><span> </span><a href="#local-6989586621679283647"><span class="hs-identifier hs-var">o1</span></a><span> </span><a href="#local-6989586621679283650"><span class="hs-identifier hs-var">o2</span></a><span> </span><a href="#local-6989586621679283651"><span class="hs-identifier hs-var">v3</span></a><span class="hs-special">]</span><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-comment">-- return both sides, and a way to put them together again</span><span>
</span><a name="line-178"></a><span class="hs-identifier">splitInfix</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span class="hs-special">,</span><span> </span><a href="HSE.Type.html#Exp_"><span class="hs-identifier hs-type">Exp_</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-179"></a><a name="splitInfix"><a href="Hint.Bracket.html#splitInfix"><span class="hs-identifier">splitInfix</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixApp</span><span> </span><a name="local-6989586621679283653"><a href="#local-6989586621679283653"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679283654"><a href="#local-6989586621679283654"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679283655"><a href="#local-6989586621679283655"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679283656"><a href="#local-6989586621679283656"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixApp</span><span> </span><a href="#local-6989586621679283653"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679283654"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679283655"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679283656"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679283657"><a href="#local-6989586621679283657"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">InfixApp</span><span> </span><a href="#local-6989586621679283653"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679283657"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679283655"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679283656"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679283654"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-180"></a><span class="hs-identifier">splitInfix</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-181"></a></pre></body></html>