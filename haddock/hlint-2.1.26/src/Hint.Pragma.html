<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><a name="line-3"></a><span class="hs-comment">{-
    Suggest better pragmas
    OPTIONS_GHC -cpp =&gt; LANGUAGE CPP
    OPTIONS_GHC -fglasgow-exts =&gt; LANGUAGE ... (in HSE)
    OPTIONS_GHC -XFoo =&gt; LANGUAGE Foo
    LANGUAGE A, A =&gt; LANGUAGE A
    -- do not do LANGUAGE A, LANGUAGE B to combine
&lt;TEST&gt;
{-# OPTIONS_GHC -cpp #-} -- {-# LANGUAGE CPP #-}
{-# OPTIONS     -cpp #-} -- {-# LANGUAGE CPP #-}
{-# OPTIONS_YHC -cpp #-}
{-# OPTIONS_GHC -XFoo #-} -- {-# LANGUAGE Foo #-}
{-# OPTIONS_GHC -fglasgow-exts #-} -- ???
{-# LANGUAGE RebindableSyntax, EmptyCase, DuplicateRecordFields, RebindableSyntax #-} -- {-# LANGUAGE RebindableSyntax, EmptyCase, DuplicateRecordFields #-}
{-# LANGUAGE RebindableSyntax #-}
{-# OPTIONS_GHC -cpp -foo #-} -- {-# LANGUAGE CPP #-} {-# OPTIONS_GHC -foo #-}
{-# OPTIONS_GHC -cpp #-} \
{-# LANGUAGE CPP, Text #-} --
{-# LANGUAGE RebindableSyntax #-} \
{-# LANGUAGE DuplicateRecordFields #-}
{-# LANGUAGE RebindableSyntax #-} \
{-# LANGUAGE EmptyCase, RebindableSyntax #-} -- {-# LANGUAGE RebindableSyntax, EmptyCase #-}
&lt;/TEST&gt;
-}</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hint.Pragma</span><span class="hs-special">(</span><a href="Hint.Pragma.html#pragmaHint"><span class="hs-identifier hs-var">pragmaHint</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="Hint.Type.html"><span class="hs-identifier">Hint.Type</span></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List.Extra</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Refact.Types</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Refact.Types</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">R</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span class="hs-identifier">pragmaHint</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Hint.Type.html#ModuHint"><span class="hs-identifier hs-type">ModuHint</span></a><span>
</span><a name="line-39"></a><a name="pragmaHint"><a href="Hint.Pragma.html#pragmaHint"><span class="hs-identifier">pragmaHint</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679269804"><a href="#local-6989586621679269804"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Hint.Pragma.html#languageDupes"><span class="hs-identifier hs-var">languageDupes</span></a><span> </span><a href="#local-6989586621679269805"><span class="hs-identifier hs-var">lang</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Hint.Pragma.html#optToPragma"><span class="hs-identifier hs-var">optToPragma</span></a><span> </span><a href="#local-6989586621679269804"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679269805"><span class="hs-identifier hs-var">lang</span></a><span>
</span><a name="line-40"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-41"></a><span>        </span><a name="local-6989586621679269805"><a href="#local-6989586621679269805"><span class="hs-identifier">lang</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679269806"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679269806"><a href="#local-6989586621679269806"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">@</span><span class="hs-identifier hs-var">LanguagePragma</span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HSE.Util.html#modulePragmas"><span class="hs-identifier hs-var">modulePragmas</span></a><span> </span><a href="#local-6989586621679269804"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-identifier">optToPragma</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.Type.html#Module_"><span class="hs-identifier hs-type">Module_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ModulePragma</span><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Idea.html#Idea"><span class="hs-identifier hs-type">Idea</span></a><span class="hs-special">]</span><span>
</span><a name="line-44"></a><a name="optToPragma"><a href="Hint.Pragma.html#optToPragma"><span class="hs-identifier">optToPragma</span></a></a><span> </span><a name="local-6989586621679269807"><a href="#local-6989586621679269807"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679269808"><a href="#local-6989586621679269808"><span class="hs-identifier">lang</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-45"></a><span>  </span><span class="hs-special">[</span><a href="Hint.Pragma.html#pragmaIdea"><span class="hs-identifier hs-var">pragmaIdea</span></a><span> </span><span class="hs-special">(</span><a href="Hint.Pragma.html#OptionsToComment"><span class="hs-identifier hs-var">OptionsToComment</span></a><span> </span><a href="#local-6989586621679269809"><span class="hs-identifier hs-var">old</span></a><span> </span><a href="#local-6989586621679269815"><span class="hs-identifier hs-var">ys</span></a><span> </span><a href="#local-6989586621679269812"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679269809"><span class="hs-identifier hs-var">old</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-46"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-47"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679269809"><a href="#local-6989586621679269809"><span class="hs-identifier">old</span></a></a><span class="hs-special">,</span><a name="local-6989586621679269810"><a href="#local-6989586621679269810"><span class="hs-identifier">new</span></a></a><span class="hs-special">,</span><a name="local-6989586621679269811"><a href="#local-6989586621679269811"><span class="hs-identifier">ns</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679269812"><a href="#local-6989586621679269812"><span class="hs-identifier">rs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-48"></a><span>          </span><span class="hs-identifier hs-var">unzip4</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679269817"><span class="hs-identifier hs-var">old</span></a><span class="hs-special">,</span><a href="#local-6989586621679269818"><span class="hs-identifier hs-var">new</span></a><span class="hs-special">,</span><a href="#local-6989586621679269819"><span class="hs-identifier hs-var">ns</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679269820"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679269817"><a href="#local-6989586621679269817"><span class="hs-identifier">old</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HSE.Util.html#modulePragmas"><span class="hs-identifier hs-var">modulePragmas</span></a><span> </span><a href="#local-6989586621679269807"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679269818"><a href="#local-6989586621679269818"><span class="hs-identifier">new</span></a></a><span class="hs-special">,</span><a name="local-6989586621679269819"><a href="#local-6989586621679269819"><span class="hs-identifier">ns</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><a href="Hint.Pragma.html#optToLanguage"><span class="hs-identifier hs-var">optToLanguage</span></a><span> </span><a href="#local-6989586621679269817"><span class="hs-identifier hs-var">old</span></a><span> </span><a href="#local-6989586621679269813"><span class="hs-identifier hs-var">ls</span></a><span class="hs-special">]</span><span>
</span><a name="line-50"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679269820"><a href="#local-6989586621679269820"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679269816"><span class="hs-identifier hs-var">mkRefact</span></a><span> </span><a href="#local-6989586621679269817"><span class="hs-identifier hs-var">old</span></a><span> </span><a href="#local-6989586621679269818"><span class="hs-identifier hs-var">new</span></a><span> </span><a href="#local-6989586621679269819"><span class="hs-identifier hs-var">ns</span></a><span class="hs-special">]</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span>        </span><a name="local-6989586621679269813"><a href="#local-6989586621679269813"><span class="hs-identifier">ls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">map</span><span> </span><a href="HSE.Match.html#fromNamed"><span class="hs-identifier hs-var">fromNamed</span></a><span> </span><a href="#local-6989586621679269821"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">LanguagePragma</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679269821"><a href="#local-6989586621679269821"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679269808"><span class="hs-identifier hs-var">lang</span></a><span class="hs-special">]</span><span>
</span><a name="line-53"></a><span>        </span><a name="local-6989586621679269814"><a href="#local-6989586621679269814"><span class="hs-identifier">ns2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nubOrd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621679269811"><span class="hs-identifier hs-var">ns</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">\\</span><span> </span><a href="#local-6989586621679269813"><span class="hs-identifier hs-var">ls</span></a><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span>        </span><a name="local-6989586621679269815"><a href="#local-6989586621679269815"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">LanguagePragma</span><span> </span><a href="HSE.Util.html#an"><span class="hs-identifier hs-var">an</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="HSE.Match.html#toNamed"><span class="hs-identifier hs-var">toNamed</span></a><span> </span><a href="#local-6989586621679269814"><span class="hs-identifier hs-var">ns2</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679269814"><span class="hs-identifier hs-var">ns2</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><a href="#local-6989586621679269810"><span class="hs-identifier hs-var">new</span></a><span>
</span><a name="line-56"></a><span>        </span><span class="hs-identifier">mkRefact</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ModulePragma</span><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ModulePragma</span><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Refactoring</span><span> </span><span class="hs-identifier hs-type">R.SrcSpan</span><span>
</span><a name="line-57"></a><span>        </span><a name="local-6989586621679269816"><a href="#local-6989586621679269816"><span class="hs-identifier">mkRefact</span></a></a><span> </span><a name="local-6989586621679269822"><a href="#local-6989586621679269822"><span class="hs-identifier">old</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-identifier hs-var">prettyPrint</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a name="local-6989586621679269823"><a href="#local-6989586621679269823"><span class="hs-identifier">new</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679269824"><a href="#local-6989586621679269824"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-58"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679269825"><a href="#local-6989586621679269825"><span class="hs-identifier">ns'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679269826"><a href="#local-6989586621679269826"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">prettyPrint</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">LanguagePragma</span><span> </span><a href="HSE.Util.html#an"><span class="hs-identifier hs-var">an</span></a><span> </span><span class="hs-special">[</span><a href="HSE.Match.html#toNamed"><span class="hs-identifier hs-var">toNamed</span></a><span> </span><a href="#local-6989586621679269826"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679269824"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-59"></a><span>          </span><span class="hs-keyword">in</span><span>
</span><a name="line-60"></a><span>          </span><span class="hs-identifier hs-var">ModifyComment</span><span> </span><span class="hs-special">(</span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679269822"><span class="hs-identifier hs-var">old</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">intercalate</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">null</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679269823"><span class="hs-identifier hs-var">new</span></a><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679269825"><span class="hs-identifier hs-var">ns'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span class="hs-keyword">data</span><span> </span><a name="PragmaIdea"><a href="Hint.Pragma.html#PragmaIdea"><span class="hs-identifier">PragmaIdea</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="SingleComment"><a href="Hint.Pragma.html#SingleComment"><span class="hs-identifier">SingleComment</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ModulePragma</span><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ModulePragma</span><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a name="MultiComment"><a href="Hint.Pragma.html#MultiComment"><span class="hs-identifier">MultiComment</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ModulePragma</span><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ModulePragma</span><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ModulePragma</span><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a name="OptionsToComment"><a href="Hint.Pragma.html#OptionsToComment"><span class="hs-identifier">OptionsToComment</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ModulePragma</span><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ModulePragma</span><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Refactoring</span><span> </span><span class="hs-identifier hs-type">R.SrcSpan</span><span class="hs-special">]</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span class="hs-identifier">pragmaIdea</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Hint.Pragma.html#PragmaIdea"><span class="hs-identifier hs-type">PragmaIdea</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Idea.html#Idea"><span class="hs-identifier hs-type">Idea</span></a><span>
</span><a name="line-68"></a><a name="pragmaIdea"><a href="Hint.Pragma.html#pragmaIdea"><span class="hs-identifier">pragmaIdea</span></a></a><span> </span><a name="local-6989586621679269827"><a href="#local-6989586621679269827"><span class="hs-identifier">pidea</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-69"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679269827"><span class="hs-identifier hs-var">pidea</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-70"></a><span>    </span><a href="Hint.Pragma.html#SingleComment"><span class="hs-identifier hs-var">SingleComment</span></a><span> </span><a name="local-6989586621679269831"><a href="#local-6989586621679269831"><span class="hs-identifier">old</span></a></a><span> </span><a name="local-6989586621679269832"><a href="#local-6989586621679269832"><span class="hs-identifier">new</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-71"></a><span>      </span><a href="#local-6989586621679269829"><span class="hs-identifier hs-var">mkFewer</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">srcInfoSpan</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">ann</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679269831"><span class="hs-identifier hs-var">old</span></a><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">prettyPrint</span><span> </span><a href="#local-6989586621679269831"><span class="hs-identifier hs-var">old</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">prettyPrint</span><span> </span><a href="#local-6989586621679269832"><span class="hs-identifier hs-var">new</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-73"></a><span>        </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ModifyComment</span><span> </span><span class="hs-special">(</span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679269831"><span class="hs-identifier hs-var">old</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">prettyPrint</span><span> </span><a href="#local-6989586621679269832"><span class="hs-identifier hs-var">new</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-74"></a><span>    </span><a href="Hint.Pragma.html#MultiComment"><span class="hs-identifier hs-var">MultiComment</span></a><span> </span><a name="local-6989586621679269833"><a href="#local-6989586621679269833"><span class="hs-identifier">repl</span></a></a><span> </span><a name="local-6989586621679269834"><a href="#local-6989586621679269834"><span class="hs-identifier">delete</span></a></a><span> </span><a name="local-6989586621679269835"><a href="#local-6989586621679269835"><span class="hs-identifier">new</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-75"></a><span>      </span><a href="#local-6989586621679269829"><span class="hs-identifier hs-var">mkFewer</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">srcInfoSpan</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">ann</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679269833"><span class="hs-identifier hs-var">repl</span></a><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span>        </span><span class="hs-special">(</span><a href="#local-6989586621679269828"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679269833"><span class="hs-identifier hs-var">repl</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679269834"><span class="hs-identifier hs-var">delete</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">prettyPrint</span><span> </span><a href="#local-6989586621679269835"><span class="hs-identifier hs-var">new</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-77"></a><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">ModifyComment</span><span> </span><span class="hs-special">(</span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679269833"><span class="hs-identifier hs-var">repl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">prettyPrint</span><span> </span><a href="#local-6989586621679269835"><span class="hs-identifier hs-var">new</span></a><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ModifyComment</span><span> </span><span class="hs-special">(</span><a href="Refact.html#toSS"><span class="hs-identifier hs-var">toSS</span></a><span> </span><a href="#local-6989586621679269834"><span class="hs-identifier hs-var">delete</span></a><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-79"></a><span>    </span><a href="Hint.Pragma.html#OptionsToComment"><span class="hs-identifier hs-var">OptionsToComment</span></a><span> </span><a name="local-6989586621679269836"><a href="#local-6989586621679269836"><span class="hs-identifier">old</span></a></a><span> </span><a name="local-6989586621679269837"><a href="#local-6989586621679269837"><span class="hs-identifier">new</span></a></a><span> </span><a name="local-6989586621679269838"><a href="#local-6989586621679269838"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-80"></a><span>      </span><a href="#local-6989586621679269830"><span class="hs-identifier hs-var">mkLanguage</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">srcInfoSpan</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">ann</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679269836"><span class="hs-identifier hs-var">old</span></a><span class="hs-special">)</span><span>
</span><a name="line-81"></a><span>        </span><span class="hs-special">(</span><a href="#local-6989586621679269828"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679269836"><span class="hs-identifier hs-var">old</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679269828"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679269837"><span class="hs-identifier hs-var">new</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-82"></a><span>        </span><a href="#local-6989586621679269838"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-83"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-84"></a><span>          </span><a name="local-6989586621679269828"><a href="#local-6989586621679269828"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unlines</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">prettyPrint</span><span>
</span><a name="line-85"></a><span>          </span><a name="local-6989586621679269829"><a href="#local-6989586621679269829"><span class="hs-identifier">mkFewer</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Idea.html#rawIdea"><span class="hs-identifier hs-var">rawIdea</span></a><span> </span><a href="Config.Type.html#Warning"><span class="hs-identifier hs-var">Warning</span></a><span> </span><span class="hs-string">&quot;Use fewer LANGUAGE pragmas&quot;</span><span>
</span><a name="line-86"></a><span>          </span><a name="local-6989586621679269830"><a href="#local-6989586621679269830"><span class="hs-identifier">mkLanguage</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Idea.html#rawIdea"><span class="hs-identifier hs-var">rawIdea</span></a><span> </span><a href="Config.Type.html#Warning"><span class="hs-identifier hs-var">Warning</span></a><span> </span><span class="hs-string">&quot;Use LANGUAGE pragmas&quot;</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span class="hs-identifier">languageDupes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ModulePragma</span><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Idea.html#Idea"><span class="hs-identifier hs-type">Idea</span></a><span class="hs-special">]</span><span>
</span><a name="line-90"></a><a name="languageDupes"><a href="Hint.Pragma.html#languageDupes"><span class="hs-identifier">languageDupes</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679269839"><a href="#local-6989586621679269839"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">LanguagePragma</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679269840"><a href="#local-6989586621679269840"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679269841"><a href="#local-6989586621679269841"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-91"></a><span>    </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="HSE.Util.html#nub_"><span class="hs-identifier hs-var">nub_</span></a><span> </span><a href="#local-6989586621679269840"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><a href="HSE.Util.html#neqList"><span class="hs-identifier hs-var">neqList</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679269840"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-92"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><a href="Hint.Pragma.html#pragmaIdea"><span class="hs-identifier hs-var">pragmaIdea</span></a><span> </span><span class="hs-special">(</span><a href="Hint.Pragma.html#SingleComment"><span class="hs-identifier hs-var">SingleComment</span></a><span> </span><a href="#local-6989586621679269839"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LanguagePragma</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ann</span><span> </span><a href="#local-6989586621679269839"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HSE.Util.html#nub_"><span class="hs-identifier hs-var">nub_</span></a><span> </span><a href="#local-6989586621679269840"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-93"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><a href="Hint.Pragma.html#pragmaIdea"><span class="hs-identifier hs-var">pragmaIdea</span></a><span> </span><span class="hs-special">(</span><a href="Hint.Pragma.html#MultiComment"><span class="hs-identifier hs-var">MultiComment</span></a><span> </span><a href="#local-6989586621679269839"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679269842"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LanguagePragma</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ann</span><span> </span><a href="#local-6989586621679269839"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="HSE.Util.html#nub_"><span class="hs-identifier hs-var">nub_</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679269840"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679269843"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679269842"><a href="#local-6989586621679269842"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">LanguagePragma</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679269843"><a href="#local-6989586621679269843"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679269841"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HSE.Util.html#intersect_"><span class="hs-identifier hs-var">intersect_</span></a><span> </span><a href="#local-6989586621679269840"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679269843"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-94"></a><span>    </span><a href="Hint.Pragma.html#languageDupes"><span class="hs-identifier hs-var">languageDupes</span></a><span> </span><a href="#local-6989586621679269841"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-95"></a><span class="hs-identifier">languageDupes</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-comment">-- Given a pragma, can you extract some language features out</span><span>
</span><a name="line-99"></a><span class="hs-identifier">strToLanguage</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-100"></a><a name="strToLanguage"><a href="Hint.Pragma.html#strToLanguage"><span class="hs-identifier">strToLanguage</span></a></a><span> </span><span class="hs-string">&quot;-cpp&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;CPP&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-101"></a><span class="hs-identifier">strToLanguage</span><span> </span><a name="local-6989586621679269844"><a href="#local-6989586621679269844"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;-X&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679269844"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621679269844"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span>
</span><a name="line-102"></a><span class="hs-identifier">strToLanguage</span><span> </span><span class="hs-string">&quot;-fglasgow-exts&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">prettyExtension</span><span> </span><span class="hs-identifier hs-var">glasgowExts</span><span>
</span><a name="line-103"></a><span class="hs-identifier">strToLanguage</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-identifier">optToLanguage</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ModulePragma</span><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ModulePragma</span><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-107"></a><a name="optToLanguage"><a href="Hint.Pragma.html#optToLanguage"><span class="hs-identifier">optToLanguage</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OptionsPragma</span><span> </span><a name="local-6989586621679269845"><a href="#local-6989586621679269845"><span class="hs-identifier">sl</span></a></a><span> </span><a name="local-6989586621679269846"><a href="#local-6989586621679269846"><span class="hs-identifier">tool</span></a></a><span> </span><a name="local-6989586621679269847"><a href="#local-6989586621679269847"><span class="hs-identifier">val</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679269848"><a href="#local-6989586621679269848"><span class="hs-identifier">ls</span></a></a><span>
</span><a name="line-108"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">GHC</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679269846"><span class="hs-identifier hs-var">tool</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-identifier hs-var">isJust</span><span> </span><a href="#local-6989586621679269850"><span class="hs-identifier hs-var">vs</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-109"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679269852"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679269848"><span class="hs-identifier hs-var">ls</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><a href="#local-6989586621679269850"><span class="hs-identifier hs-var">vs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-111"></a><span>        </span><a name="local-6989586621679269849"><a href="#local-6989586621679269849"><span class="hs-identifier">strs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">words</span><span> </span><a href="#local-6989586621679269847"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-112"></a><span>        </span><a name="local-6989586621679269850"><a href="#local-6989586621679269850"><span class="hs-identifier">vs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Hint.Pragma.html#strToLanguage"><span class="hs-identifier hs-var">strToLanguage</span></a><span> </span><a href="#local-6989586621679269849"><span class="hs-identifier hs-var">strs</span></a><span>
</span><a name="line-113"></a><span>        </span><a name="local-6989586621679269851"><a href="#local-6989586621679269851"><span class="hs-identifier">keep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679269853"><a href="#local-6989586621679269853"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621679269854"><a href="#local-6989586621679269854"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679269854"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isNothing</span><span> </span><a href="#local-6989586621679269853"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679269850"><span class="hs-identifier hs-var">vs</span></a><span> </span><a href="#local-6989586621679269849"><span class="hs-identifier hs-var">strs</span></a><span>
</span><a name="line-114"></a><span>        </span><a name="local-6989586621679269852"><a href="#local-6989586621679269852"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679269851"><span class="hs-identifier hs-var">keep</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">OptionsPragma</span><span> </span><a href="#local-6989586621679269845"><span class="hs-identifier hs-var">sl</span></a><span> </span><a href="#local-6989586621679269846"><span class="hs-identifier hs-var">tool</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unwords</span><span> </span><a href="#local-6989586621679269851"><span class="hs-identifier hs-var">keep</span></a><span class="hs-special">)</span><span>
</span><a name="line-115"></a><span class="hs-identifier">optToLanguage</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-116"></a></pre></body></html>