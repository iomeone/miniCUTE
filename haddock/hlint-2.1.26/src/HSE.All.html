<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE PackageImports #-}</span><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">HSE.All</span><span class="hs-special">(</span><span>
</span><a name="line-6"></a><span>    </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">X</span><span class="hs-special">,</span><span>
</span><a name="line-7"></a><span>    </span><a href="HSE.All.html#CppFlags"><span class="hs-identifier hs-type">CppFlags</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HSE.All.html#ParseFlags"><span class="hs-identifier hs-type">ParseFlags</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HSE.All.html#defaultParseFlags"><span class="hs-identifier hs-var">defaultParseFlags</span></a><span class="hs-special">,</span><span>
</span><a name="line-8"></a><span>    </span><a href="HSE.All.html#parseFlagsAddFixities"><span class="hs-identifier hs-var">parseFlagsAddFixities</span></a><span class="hs-special">,</span><span> </span><a href="HSE.All.html#parseFlagsSetLanguage"><span class="hs-identifier hs-var">parseFlagsSetLanguage</span></a><span class="hs-special">,</span><span>
</span><a name="line-9"></a><span>    </span><a href="HSE.All.html#ParseError"><span class="hs-identifier hs-type">ParseError</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HSE.All.html#ModuleEx"><span class="hs-identifier hs-type">ModuleEx</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-10"></a><span>    </span><a href="HSE.All.html#parseModuleEx"><span class="hs-identifier hs-var">parseModuleEx</span></a><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>    </span><a href="HSE.All.html#freeVars"><span class="hs-identifier hs-var">freeVars</span></a><span class="hs-special">,</span><span> </span><a href="HSE.All.html#vars"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><a href="HSE.All.html#varss"><span class="hs-identifier hs-var">varss</span></a><span class="hs-special">,</span><span> </span><a href="HSE.All.html#pvars"><span class="hs-identifier hs-var">pvars</span></a><span>
</span><a name="line-12"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language.Haskell.Exts.Util</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">freeVars</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Vars</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.Haskell.Exts.Util</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">X</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><a href="HSE.Util.html"><span class="hs-identifier">HSE.Util</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">X</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><a href="HSE.Reduce.html"><span class="hs-identifier">HSE.Reduce</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">X</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="HSE.Type.html"><span class="hs-identifier">HSE.Type</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">X</span><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="HSE.Match.html"><span class="hs-identifier">HSE.Match</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">X</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><a href="HSE.Scope.html"><span class="hs-identifier">HSE.Scope</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">X</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Char</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List.Extra</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="Timing.html"><span class="hs-identifier">Timing</span></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language.Preprocessor.Cpphs</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Either</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Set</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Set</span><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Set</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Set</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.IO.Extra</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Functor</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.Util.html"><span class="hs-identifier">GHC.Util</span></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-string">&quot;ghc-lib-parser&quot;</span><span> </span><span class="hs-identifier">HsSyn</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-string">&quot;ghc-lib-parser&quot;</span><span> </span><span class="hs-identifier">FastString</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-string">&quot;ghc-lib-parser&quot;</span><span> </span><span class="hs-identifier">SrcLoc</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">GHC</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-string">&quot;ghc-lib-parser&quot;</span><span> </span><span class="hs-identifier">ErrUtils</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-string">&quot;ghc-lib-parser&quot;</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-string">&quot;ghc-lib-parser&quot;</span><span> </span><span class="hs-identifier">GHC.LanguageExtensions.Type</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">GHC</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-identifier">vars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span> </span><a href="#local-6989586621679220261"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679220261"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-44"></a><span class="hs-identifier">freeVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span> </span><a href="#local-6989586621679220260"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679220260"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Set</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-45"></a><span class="hs-identifier">varss</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pvars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">AllVars</span><span> </span><a href="#local-6989586621679219960"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679219960"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-46"></a><a name="vars"><a href="HSE.All.html#vars"><span class="hs-identifier">vars</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Set.toList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Set.map</span><span> </span><span class="hs-identifier hs-var">prettyPrint</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">X.freeVars</span><span>
</span><a name="line-47"></a><a name="varss"><a href="HSE.All.html#varss"><span class="hs-identifier">varss</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Set.toList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Set.map</span><span> </span><span class="hs-identifier hs-var">prettyPrint</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">X.free</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">X.allVars</span><span>
</span><a name="line-48"></a><a name="pvars"><a href="HSE.All.html#pvars"><span class="hs-identifier">pvars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Set.toList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Set.map</span><span> </span><span class="hs-identifier hs-var">prettyPrint</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">X.bound</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">X.allVars</span><span>
</span><a name="line-49"></a><a name="freeVars"><a href="HSE.All.html#freeVars"><span class="hs-identifier">freeVars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Set.map</span><span> </span><span class="hs-identifier hs-var">prettyPrint</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">X.freeVars</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-comment">-- | What C pre processor should be used.</span><span>
</span><a name="line-52"></a><span class="hs-keyword">data</span><span> </span><a name="CppFlags"><a href="HSE.All.html#CppFlags"><span class="hs-identifier">CppFlags</span></a></a><span>
</span><a name="line-53"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="NoCpp"><a href="HSE.All.html#NoCpp"><span class="hs-identifier">NoCpp</span></a></a><span> </span><span class="hs-comment">-- ^ No pre processing is done.</span><span>
</span><a name="line-54"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="CppSimple"><a href="HSE.All.html#CppSimple"><span class="hs-identifier">CppSimple</span></a></a><span> </span><span class="hs-comment">-- ^ Lines prefixed with @#@ are stripped.</span><span>
</span><a name="line-55"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Cpphs"><a href="HSE.All.html#Cpphs"><span class="hs-identifier">Cpphs</span></a></a><span> </span><span class="hs-identifier hs-type">CpphsOptions</span><span> </span><span class="hs-comment">-- ^ The @cpphs@ library is used.</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-comment">-- | Created with 'defaultParseFlags', used by 'parseModuleEx'.</span><span>
</span><a name="line-58"></a><span class="hs-keyword">data</span><span> </span><a name="ParseFlags"><a href="HSE.All.html#ParseFlags"><span class="hs-identifier">ParseFlags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ParseFlags"><a href="HSE.All.html#ParseFlags"><span class="hs-identifier">ParseFlags</span></a></a><span>
</span><a name="line-59"></a><span>    </span><span class="hs-special">{</span><a name="cppFlags"><a href="HSE.All.html#cppFlags"><span class="hs-identifier">cppFlags</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.All.html#CppFlags"><span class="hs-identifier hs-type">CppFlags</span></a><span> </span><span class="hs-comment">-- ^ How the file is preprocessed (defaults to 'NoCpp').</span><span>
</span><a name="line-60"></a><span>    </span><span class="hs-special">,</span><a name="hseFlags"><a href="HSE.All.html#hseFlags"><span class="hs-identifier">hseFlags</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ParseMode</span><span> </span><span class="hs-comment">-- ^ How the file is parsed (defaults to all fixities in the @base@ package and most non-conflicting extensions).</span><span>
</span><a name="line-61"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-identifier">lensFixities</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Fixity</span><span class="hs-special">]</span><span>
</span><a name="line-64"></a><a name="lensFixities"><a href="HSE.All.html#lensFixities"><span class="hs-identifier">lensFixities</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span>
</span><a name="line-65"></a><span>    </span><span class="hs-comment">-- List as provided at https://github.com/ndmitchell/hlint/issues/416</span><span>
</span><a name="line-66"></a><span>    </span><span class="hs-special">[</span><span class="hs-identifier hs-var">infixr_</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;%%@~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;%@~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;%%~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;+~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;*~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;-~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;//~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;^~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;^^~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;**~&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-67"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infix_</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;%%@=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;%@=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;%%=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;+=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;*=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;-=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;//=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;^=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;^^=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;**=&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-68"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixr_</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&lt;&lt;~&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-69"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixr_</span><span> </span><span class="hs-number">9</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;#.&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-70"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixl_</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;.#&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-71"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixr_</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;^!&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;^@!&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-72"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixl_</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&amp;&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;&amp;&gt;&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;??&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-73"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixl_</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;^.&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;^@.&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-74"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixr_</span><span> </span><span class="hs-number">9</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&lt;.&gt;&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;.&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;.&gt;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-75"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixr_</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;%@~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;.~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;+~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;*~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;-~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;//~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;^~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;^^~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;**~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&amp;&amp;~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;&gt;~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;||~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;%~&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-76"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infix_</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;%@=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;.=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;+=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;*=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;-=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;//=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;^=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;^^=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;**=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&amp;&amp;=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;&gt;=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;||=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;%=&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-77"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixr_</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&lt;~&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-78"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixr_</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;`zoom`&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;`magnify`&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-79"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixl_</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;^..&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;^?&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;^?!&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;^@..&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;^@?&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;^@?!&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-80"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixl_</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;^#&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-81"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixr_</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&lt;#~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;#~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;#%~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;#%~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;#%%~&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-82"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infix_</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&lt;#=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;#=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;#%=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;#%=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;#%%=&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-83"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixl_</span><span> </span><span class="hs-number">9</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;:&gt;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-84"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixr_</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&lt;/&gt;~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;&lt;/&gt;~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;.&gt;~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;&lt;.&gt;~&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-85"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infix_</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&lt;/&gt;=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;&lt;/&gt;=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;.&gt;=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;&lt;.&gt;=&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-86"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixr_</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;.|.~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;.&amp;.~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;.|.~&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;.&amp;.~&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-87"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infix_</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;.|.=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;.&amp;.=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;.|.=&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;.&amp;.=&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-88"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-identifier">otherFixities</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Fixity</span><span class="hs-special">]</span><span>
</span><a name="line-91"></a><a name="otherFixities"><a href="HSE.All.html#otherFixities"><span class="hs-identifier">otherFixities</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span>
</span><a name="line-92"></a><span>    </span><span class="hs-comment">-- hspec</span><span>
</span><a name="line-93"></a><span>    </span><span class="hs-special">[</span><span class="hs-identifier hs-var">infix_</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;`shouldBe`&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;`shouldSatisfy`&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;`shouldStartWith`&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;`shouldEndWith`&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;`shouldContain`&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;`shouldMatchList`&quot;</span><span>
</span><a name="line-94"></a><span>              </span><span class="hs-special">,</span><span class="hs-string">&quot;`shouldReturn`&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;`shouldNotBe`&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;`shouldNotSatisfy`&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;`shouldNotContain`&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;`shouldNotReturn`&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;`shouldThrow`&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-95"></a><span>    </span><span class="hs-comment">-- quickcheck</span><span>
</span><a name="line-96"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixr_</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;==&gt;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-97"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infix_</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;===&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-98"></a><span>    </span><span class="hs-comment">-- esqueleto</span><span>
</span><a name="line-99"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infix_</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;==.&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-100"></a><span>    </span><span class="hs-comment">-- lattices</span><span>
</span><a name="line-101"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixr_</span><span> </span><span class="hs-number">5</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;\\/&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- \/</span><span>
</span><a name="line-102"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixr_</span><span> </span><span class="hs-number">6</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;/\\&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- /\</span><span>
</span><a name="line-103"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-comment">-- Fixites from the `base` package which are currently</span><span>
</span><a name="line-106"></a><span class="hs-comment">-- missing from `haskell-src-exts`'s baseFixities.</span><span>
</span><a name="line-107"></a><span class="hs-comment">-- see https://github.com/haskell-suite/haskell-src-exts/pull/400</span><span>
</span><a name="line-108"></a><span class="hs-identifier">baseNotYetInHSE</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Fixity</span><span class="hs-special">]</span><span>
</span><a name="line-109"></a><a name="baseNotYetInHSE"><a href="HSE.All.html#baseNotYetInHSE"><span class="hs-identifier">baseNotYetInHSE</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span>
</span><a name="line-110"></a><span>    </span><span class="hs-special">[</span><span class="hs-identifier hs-var">infixr_</span><span> </span><span class="hs-number">9</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;`Compose`&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-111"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixr_</span><span> </span><span class="hs-number">6</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&lt;&gt;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-112"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixr_</span><span> </span><span class="hs-number">5</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&lt;|&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-113"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infixl_</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&lt;$!&gt;&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&lt;$&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;$&gt;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-114"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier hs-var">infix_</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;:~:&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;:~~:&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-115"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-identifier">customFixities</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Fixity</span><span class="hs-special">]</span><span>
</span><a name="line-118"></a><a name="customFixities"><a href="HSE.All.html#customFixities"><span class="hs-identifier">customFixities</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-119"></a><span>    </span><span class="hs-identifier hs-var">infixl_</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;`on`&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-120"></a><span>        </span><span class="hs-comment">-- see https://github.com/ndmitchell/hlint/issues/425</span><span>
</span><a name="line-121"></a><span>        </span><span class="hs-comment">-- otherwise GTK apps using `on` at a different fixity have spurious warnings</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span class="hs-comment">-- | Default value for 'ParseFlags'.</span><span>
</span><a name="line-124"></a><span class="hs-identifier">defaultParseFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.All.html#ParseFlags"><span class="hs-identifier hs-type">ParseFlags</span></a><span>
</span><a name="line-125"></a><a name="defaultParseFlags"><a href="HSE.All.html#defaultParseFlags"><span class="hs-identifier">defaultParseFlags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HSE.All.html#ParseFlags"><span class="hs-identifier hs-var">ParseFlags</span></a><span> </span><a href="HSE.All.html#NoCpp"><span class="hs-identifier hs-var">NoCpp</span></a><span> </span><span class="hs-identifier hs-var">defaultParseMode</span><span>
</span><a name="line-126"></a><span>    </span><span class="hs-special">{</span><span class="hs-identifier">fixities</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HSE.All.html#customFixities"><span class="hs-identifier hs-var">customFixities</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">baseFixities</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="HSE.All.html#baseNotYetInHSE"><span class="hs-identifier hs-var">baseNotYetInHSE</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="HSE.All.html#lensFixities"><span class="hs-identifier hs-var">lensFixities</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="HSE.All.html#otherFixities"><span class="hs-identifier hs-var">otherFixities</span></a><span>
</span><a name="line-127"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier">ignoreLinePragmas</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-128"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier">ignoreFunctionArity</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-129"></a><span>    </span><span class="hs-special">,</span><span class="hs-identifier">extensions</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#defaultExtensions"><span class="hs-identifier hs-var">defaultExtensions</span></a><span class="hs-special">}</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-identifier">parseFlagsNoLocations</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.All.html#ParseFlags"><span class="hs-identifier hs-type">ParseFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.All.html#ParseFlags"><span class="hs-identifier hs-type">ParseFlags</span></a><span>
</span><a name="line-132"></a><a name="parseFlagsNoLocations"><a href="HSE.All.html#parseFlagsNoLocations"><span class="hs-identifier">parseFlagsNoLocations</span></a></a><span> </span><a name="local-6989586621679220262"><a href="#local-6989586621679220262"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679220262"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">{</span><span class="hs-identifier">cppFlags</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">cppFlags</span><span> </span><a href="#local-6989586621679220262"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span> </span><a href="HSE.All.html#Cpphs"><span class="hs-identifier hs-var">Cpphs</span></a><span> </span><a name="local-6989586621679220265"><a href="#local-6989586621679220265"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.All.html#Cpphs"><span class="hs-identifier hs-var">Cpphs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679220263"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679220265"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">;</span><span> </span><a name="local-6989586621679220266"><a href="#local-6989586621679220266"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679220266"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">}</span><span>
</span><a name="line-133"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679220263"><a href="#local-6989586621679220263"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679220264"><a href="#local-6989586621679220264"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679220264"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">{</span><span class="hs-identifier">boolopts</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">boolopts</span><span> </span><a href="#local-6989586621679220264"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">{</span><span class="hs-identifier">locations</span><span class="hs-glyph">=</span><span class="hs-identifier hs-var">False</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-134"></a><span>
</span><a name="line-135"></a><span class="hs-comment">-- | Given some fixities, add them to the existing fixities in 'ParseFlags'.</span><span>
</span><a name="line-136"></a><span class="hs-identifier">parseFlagsAddFixities</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Fixity</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.All.html#ParseFlags"><span class="hs-identifier hs-type">ParseFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.All.html#ParseFlags"><span class="hs-identifier hs-type">ParseFlags</span></a><span>
</span><a name="line-137"></a><a name="parseFlagsAddFixities"><a href="HSE.All.html#parseFlagsAddFixities"><span class="hs-identifier">parseFlagsAddFixities</span></a></a><span> </span><a name="local-6989586621679220267"><a href="#local-6989586621679220267"><span class="hs-identifier">fx</span></a></a><span> </span><a name="local-6989586621679220268"><a href="#local-6989586621679220268"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679220268"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">{</span><span class="hs-identifier">hseFlags</span><span class="hs-glyph">=</span><a href="#local-6989586621679220269"><span class="hs-identifier hs-var">hse</span></a><span class="hs-special">{</span><span class="hs-identifier">fixities</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679220267"><span class="hs-identifier hs-var">fx</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fixities</span><span> </span><a href="#local-6989586621679220269"><span class="hs-identifier hs-var">hse</span></a><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-138"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679220269"><a href="#local-6989586621679220269"><span class="hs-identifier">hse</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hseFlags</span><span> </span><a href="#local-6989586621679220268"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-identifier">parseFlagsSetLanguage</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Language</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Extension</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.All.html#ParseFlags"><span class="hs-identifier hs-type">ParseFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.All.html#ParseFlags"><span class="hs-identifier hs-type">ParseFlags</span></a><span>
</span><a name="line-141"></a><a name="parseFlagsSetLanguage"><a href="HSE.All.html#parseFlagsSetLanguage"><span class="hs-identifier">parseFlagsSetLanguage</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679220270"><a href="#local-6989586621679220270"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679220271"><a href="#local-6989586621679220271"><span class="hs-identifier">es</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679220272"><a href="#local-6989586621679220272"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679220272"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">{</span><span class="hs-identifier">hseFlags</span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="hs-identifier">hseFlags</span><span> </span><a href="#local-6989586621679220272"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">{</span><span class="hs-identifier">baseLanguage</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679220270"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">extensions</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679220271"><span class="hs-identifier hs-var">es</span></a><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-142"></a><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span class="hs-identifier">runCpp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.All.html#CppFlags"><span class="hs-identifier hs-type">CppFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-145"></a><a name="runCpp"><a href="HSE.All.html#runCpp"><span class="hs-identifier">runCpp</span></a></a><span> </span><a href="HSE.All.html#NoCpp"><span class="hs-identifier hs-var">NoCpp</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679220273"><a href="#local-6989586621679220273"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679220273"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-146"></a><span class="hs-identifier">runCpp</span><span> </span><a href="HSE.All.html#CppSimple"><span class="hs-identifier hs-var">CppSimple</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679220274"><a href="#local-6989586621679220274"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unlines</span><span> </span><span class="hs-special">[</span><span class="hs-keyword">if</span><span> </span><span class="hs-string">&quot;#&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">trimStart</span><span> </span><a href="#local-6989586621679220275"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679220275"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679220275"><a href="#local-6989586621679220275"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lines</span><span> </span><a href="#local-6989586621679220274"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span>
</span><a name="line-147"></a><span class="hs-identifier">runCpp</span><span> </span><span class="hs-special">(</span><a href="HSE.All.html#Cpphs"><span class="hs-identifier hs-var">Cpphs</span></a><span> </span><a name="local-6989586621679220276"><a href="#local-6989586621679220276"><span class="hs-identifier">o</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679220277"><a href="#local-6989586621679220277"><span class="hs-identifier">file</span></a></a><span> </span><a name="local-6989586621679220278"><a href="#local-6989586621679220278"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679220279"><span class="hs-identifier hs-var">dropLine</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">runCpphs</span><span> </span><a href="#local-6989586621679220276"><span class="hs-identifier hs-var">o</span></a><span> </span><a href="#local-6989586621679220277"><span class="hs-identifier hs-var">file</span></a><span> </span><a href="#local-6989586621679220278"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-148"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-149"></a><span>        </span><span class="hs-comment">-- LINE pragmas always inserted when locations=True</span><span>
</span><a name="line-150"></a><span>        </span><a name="local-6989586621679220279"><a href="#local-6989586621679220279"><span class="hs-identifier">dropLine</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">line1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679220280"><a href="#local-6989586621679220280"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621679220281"><a href="#local-6989586621679220281"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;{-# LINE &quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679220280"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679220281"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-151"></a><span>        </span><span class="hs-identifier">dropLine</span><span> </span><a name="local-6989586621679220282"><a href="#local-6989586621679220282"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679220282"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span class="hs-comment">---------------------------------------------------------------------</span><span>
</span><a name="line-154"></a><span class="hs-comment">-- PARSING</span><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span class="hs-comment">-- | A parse error.</span><span>
</span><a name="line-157"></a><span class="hs-keyword">data</span><span> </span><a name="ParseError"><a href="HSE.All.html#ParseError"><span class="hs-identifier">ParseError</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ParseError"><a href="HSE.All.html#ParseError"><span class="hs-identifier">ParseError</span></a></a><span>
</span><a name="line-158"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="parseErrorLocation"><a href="HSE.All.html#parseErrorLocation"><span class="hs-identifier">parseErrorLocation</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SrcLoc</span><span> </span><span class="hs-comment">-- ^ Location of the error.</span><span>
</span><a name="line-159"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="parseErrorMessage"><a href="HSE.All.html#parseErrorMessage"><span class="hs-identifier">parseErrorMessage</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>  </span><span class="hs-comment">-- ^ Message about the cause of the error.</span><span>
</span><a name="line-160"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="parseErrorContents"><a href="HSE.All.html#parseErrorContents"><span class="hs-identifier">parseErrorContents</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^ Snippet of several lines (typically 5) including a @&gt;@ character pointing at the faulty line.</span><span>
</span><a name="line-161"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span class="hs-comment">-- | Result of 'parseModuleEx', representing a parsed module.</span><span>
</span><a name="line-164"></a><span class="hs-keyword">data</span><span> </span><a name="ModuleEx"><a href="HSE.All.html#ModuleEx"><span class="hs-identifier">ModuleEx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ModuleEx"><a href="HSE.All.html#ModuleEx"><span class="hs-identifier">ModuleEx</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-165"></a><span>    </span><span class="hs-comment">-- Combined 'hs-src-ext' and 'ghc-lib-parser' parse trees.</span><span>
</span><a name="line-166"></a><span>    </span><a name="pm_hsext"><a href="HSE.All.html#pm_hsext"><span class="hs-identifier">pm_hsext</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Module</span><span> </span><span class="hs-identifier hs-type">SrcSpanInfo</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Comment</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- hs-src-ext result</span><span>
</span><a name="line-167"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="pm_ghclib"><a href="HSE.All.html#pm_ghclib"><span class="hs-identifier">pm_ghclib</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsSyn.HsModule</span><span> </span><span class="hs-identifier hs-type">HsSyn.GhcPs</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ghc-lib-parser result</span><span>
</span><a name="line-168"></a><span class="hs-special">}</span><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span class="hs-comment">-- | Utility called from 'parseModuleEx' and 'hseFailOpParseModuleEx'.</span><span>
</span><a name="line-171"></a><span class="hs-identifier">mkMode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.All.html#ParseFlags"><span class="hs-identifier hs-type">ParseFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ParseMode</span><span>
</span><a name="line-172"></a><a name="mkMode"><a href="HSE.All.html#mkMode"><span class="hs-identifier">mkMode</span></a></a><span> </span><a name="local-6989586621679220319"><a href="#local-6989586621679220319"><span class="hs-identifier">flags</span></a></a><span> </span><a name="local-6989586621679220320"><a href="#local-6989586621679220320"><span class="hs-identifier">file</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hseFlags</span><span> </span><a href="#local-6989586621679220319"><span class="hs-identifier hs-var">flags</span></a><span class="hs-special">)</span><span class="hs-special">{</span><span class="hs-identifier">parseFilename</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679220320"><span class="hs-identifier hs-var">file</span></a><span class="hs-special">,</span><span class="hs-identifier">fixities</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-comment">-- | Error handler dispatcher. Invoked when HSE parsing has failed.</span><span>
</span><a name="line-175"></a><span class="hs-identifier">failOpParseModuleEx</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-176"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.All.html#ParseFlags"><span class="hs-identifier hs-type">ParseFlags</span></a><span>
</span><a name="line-177"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-178"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-179"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SrcLoc</span><span>
</span><a name="line-180"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-181"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">GHC.SrcSpan</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ErrUtils.MsgDoc</span><span class="hs-special">)</span><span>
</span><a name="line-182"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="HSE.All.html#ParseError"><span class="hs-identifier hs-type">ParseError</span></a><span> </span><a href="HSE.All.html#ModuleEx"><span class="hs-identifier hs-type">ModuleEx</span></a><span class="hs-special">)</span><span>
</span><a name="line-183"></a><a name="failOpParseModuleEx"><a href="HSE.All.html#failOpParseModuleEx"><span class="hs-identifier">failOpParseModuleEx</span></a></a><span> </span><a name="local-6989586621679220321"><a href="#local-6989586621679220321"><span class="hs-identifier">ppstr</span></a></a><span> </span><a name="local-6989586621679220322"><a href="#local-6989586621679220322"><span class="hs-identifier">flags</span></a></a><span> </span><a name="local-6989586621679220323"><a href="#local-6989586621679220323"><span class="hs-identifier">file</span></a></a><span> </span><a name="local-6989586621679220324"><a href="#local-6989586621679220324"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621679220325"><a href="#local-6989586621679220325"><span class="hs-identifier">sl</span></a></a><span> </span><a name="local-6989586621679220326"><a href="#local-6989586621679220326"><span class="hs-identifier">msg</span></a></a><span> </span><a name="local-6989586621679220327"><a href="#local-6989586621679220327"><span class="hs-identifier">ghc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-184"></a><span>   </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679220327"><span class="hs-identifier hs-var">ghc</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-185"></a><span>     </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679220328"><a href="#local-6989586621679220328"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-186"></a><span>       </span><span class="hs-comment">-- GHC error info is available (assumed to have come from a</span><span>
</span><a name="line-187"></a><span>       </span><span class="hs-comment">-- 'PFailed'). We prefer to construct a 'ParseError' value</span><span>
</span><a name="line-188"></a><span>       </span><span class="hs-comment">-- using that.</span><span>
</span><a name="line-189"></a><span>       </span><a href="HSE.All.html#ghcFailOpParseModuleEx"><span class="hs-identifier hs-var">ghcFailOpParseModuleEx</span></a><span> </span><a href="#local-6989586621679220321"><span class="hs-identifier hs-var">ppstr</span></a><span> </span><a href="#local-6989586621679220323"><span class="hs-identifier hs-var">file</span></a><span> </span><a href="#local-6989586621679220324"><span class="hs-identifier hs-var">str</span></a><span> </span><a href="#local-6989586621679220328"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-190"></a><span>     </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-191"></a><span>       </span><span class="hs-comment">-- No GHC error info provided. This is the traditional approach</span><span>
</span><a name="line-192"></a><span>       </span><span class="hs-comment">-- to handling errors.</span><span>
</span><a name="line-193"></a><span>       </span><a href="HSE.All.html#hseFailOpParseModuleEx"><span class="hs-identifier hs-var">hseFailOpParseModuleEx</span></a><span> </span><a href="#local-6989586621679220321"><span class="hs-identifier hs-var">ppstr</span></a><span> </span><a href="#local-6989586621679220322"><span class="hs-identifier hs-var">flags</span></a><span> </span><a href="#local-6989586621679220323"><span class="hs-identifier hs-var">file</span></a><span> </span><a href="#local-6989586621679220324"><span class="hs-identifier hs-var">str</span></a><span> </span><a href="#local-6989586621679220325"><span class="hs-identifier hs-var">sl</span></a><span> </span><a href="#local-6989586621679220326"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span class="hs-comment">-- | An error handler of last resort. This is invoked when HSE parsing</span><span>
</span><a name="line-196"></a><span class="hs-comment">-- has failed but apparently GHC has not!</span><span>
</span><a name="line-197"></a><span class="hs-identifier">hseFailOpParseModuleEx</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-198"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.All.html#ParseFlags"><span class="hs-identifier hs-type">ParseFlags</span></a><span>
</span><a name="line-199"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-200"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-201"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SrcLoc</span><span>
</span><a name="line-202"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-203"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="HSE.All.html#ParseError"><span class="hs-identifier hs-type">ParseError</span></a><span> </span><a href="HSE.All.html#ModuleEx"><span class="hs-identifier hs-type">ModuleEx</span></a><span class="hs-special">)</span><span>
</span><a name="line-204"></a><a name="hseFailOpParseModuleEx"><a href="HSE.All.html#hseFailOpParseModuleEx"><span class="hs-identifier">hseFailOpParseModuleEx</span></a></a><span> </span><a name="local-6989586621679220329"><a href="#local-6989586621679220329"><span class="hs-identifier">ppstr</span></a></a><span> </span><a name="local-6989586621679220330"><a href="#local-6989586621679220330"><span class="hs-identifier">flags</span></a></a><span> </span><a name="local-6989586621679220331"><a href="#local-6989586621679220331"><span class="hs-identifier">file</span></a></a><span> </span><a name="local-6989586621679220332"><a href="#local-6989586621679220332"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621679220333"><a href="#local-6989586621679220333"><span class="hs-identifier">sl</span></a></a><span> </span><a name="local-6989586621679220334"><a href="#local-6989586621679220334"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-205"></a><span>    </span><a name="local-6989586621679220335"><a href="#local-6989586621679220335"><span class="hs-identifier">flags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HSE.All.html#parseFlagsNoLocations"><span class="hs-identifier hs-var">parseFlagsNoLocations</span></a><span> </span><a href="#local-6989586621679220330"><span class="hs-identifier hs-var">flags</span></a><span>
</span><a name="line-206"></a><span>    </span><a name="local-6989586621679220336"><a href="#local-6989586621679220336"><span class="hs-identifier">ppstr2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HSE.All.html#runCpp"><span class="hs-identifier hs-var">runCpp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">cppFlags</span><span> </span><a href="#local-6989586621679220335"><span class="hs-identifier hs-var">flags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679220331"><span class="hs-identifier hs-var">file</span></a><span> </span><a href="#local-6989586621679220332"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-207"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679220337"><a href="#local-6989586621679220337"><span class="hs-identifier">pe</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">parseFileContentsWithMode</span><span> </span><span class="hs-special">(</span><a href="HSE.All.html#mkMode"><span class="hs-identifier hs-var">mkMode</span></a><span> </span><a href="#local-6989586621679220335"><span class="hs-identifier hs-var">flags</span></a><span> </span><a href="#local-6989586621679220331"><span class="hs-identifier hs-var">file</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679220336"><span class="hs-identifier hs-var">ppstr2</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-208"></a><span>               </span><span class="hs-identifier hs-var">ParseFailed</span><span> </span><a name="local-6989586621679220338"><a href="#local-6989586621679220338"><span class="hs-identifier">sl2</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.All.html#context"><span class="hs-identifier hs-var">context</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">srcLine</span><span> </span><a href="#local-6989586621679220338"><span class="hs-identifier hs-var">sl2</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679220336"><span class="hs-identifier hs-var">ppstr2</span></a><span>
</span><a name="line-209"></a><span>               </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.All.html#context"><span class="hs-identifier hs-var">context</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">srcLine</span><span> </span><a href="#local-6989586621679220333"><span class="hs-identifier hs-var">sl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679220329"><span class="hs-identifier hs-var">ppstr</span></a><span>
</span><a name="line-210"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HSE.All.html#ParseError"><span class="hs-identifier hs-var">ParseError</span></a><span> </span><a href="#local-6989586621679220333"><span class="hs-identifier hs-var">sl</span></a><span> </span><a href="#local-6989586621679220334"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="#local-6989586621679220337"><span class="hs-identifier hs-var">pe</span></a><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span class="hs-comment">-- | The error handler invoked when GHC parsing has failed.</span><span>
</span><a name="line-213"></a><span class="hs-identifier">ghcFailOpParseModuleEx</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-214"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-215"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-216"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">GHC.SrcSpan</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ErrUtils.MsgDoc</span><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="HSE.All.html#ParseError"><span class="hs-identifier hs-type">ParseError</span></a><span> </span><a href="HSE.All.html#ModuleEx"><span class="hs-identifier hs-type">ModuleEx</span></a><span class="hs-special">)</span><span>
</span><a name="line-218"></a><a name="ghcFailOpParseModuleEx"><a href="HSE.All.html#ghcFailOpParseModuleEx"><span class="hs-identifier">ghcFailOpParseModuleEx</span></a></a><span> </span><a name="local-6989586621679220339"><a href="#local-6989586621679220339"><span class="hs-identifier">ppstr</span></a></a><span> </span><a name="local-6989586621679220340"><a href="#local-6989586621679220340"><span class="hs-identifier">file</span></a></a><span> </span><a name="local-6989586621679220341"><a href="#local-6989586621679220341"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679220342"><a href="#local-6989586621679220342"><span class="hs-identifier">loc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679220343"><a href="#local-6989586621679220343"><span class="hs-identifier">err</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-219"></a><span>   </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679220344"><a href="#local-6989586621679220344"><span class="hs-identifier">sl</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-220"></a><span>         </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679220342"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-221"></a><span>           </span><span class="hs-identifier hs-var">GHC.RealSrcSpan</span><span> </span><a name="local-6989586621679220347"><a href="#local-6989586621679220347"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-222"></a><span>             </span><span class="hs-identifier hs-var">SrcLoc</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">srcFilename</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">FastString.unpackFS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">GHC.srcSpanFile</span><span> </span><a href="#local-6989586621679220347"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-223"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">srcLine</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GHC.srcSpanStartLine</span><span> </span><a href="#local-6989586621679220347"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-224"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">srcColumn</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GHC.srcSpanStartCol</span><span> </span><a href="#local-6989586621679220347"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-225"></a><span>           </span><span class="hs-identifier hs-var">GHC.UnhelpfulSpan</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-226"></a><span>             </span><span class="hs-identifier hs-var">SrcLoc</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">srcFilename</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679220340"><span class="hs-identifier hs-var">file</span></a><span>
</span><a name="line-227"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">srcLine</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-228"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">srcColumn</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-229"></a><span>       </span><a name="local-6989586621679220345"><a href="#local-6989586621679220345"><span class="hs-identifier">pe</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HSE.All.html#context"><span class="hs-identifier hs-var">context</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">srcLine</span><span> </span><a href="#local-6989586621679220344"><span class="hs-identifier hs-var">sl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679220339"><span class="hs-identifier hs-var">ppstr</span></a><span>
</span><a name="line-230"></a><span>       </span><a name="local-6989586621679220346"><a href="#local-6989586621679220346"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Outputable.showSDoc</span><span> </span><a href="GHC.Util.html#baseDynFlags"><span class="hs-identifier hs-var">baseDynFlags</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-231"></a><span>               </span><span class="hs-identifier hs-var">ErrUtils.pprLocErrMsg</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ErrUtils.mkPlainErrMsg</span><span> </span><a href="GHC.Util.html#baseDynFlags"><span class="hs-identifier hs-var">baseDynFlags</span></a><span> </span><a href="#local-6989586621679220342"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621679220343"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span>
</span><a name="line-232"></a><span>   </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HSE.All.html#ParseError"><span class="hs-identifier hs-var">ParseError</span></a><span> </span><a href="#local-6989586621679220344"><span class="hs-identifier hs-var">sl</span></a><span> </span><a href="#local-6989586621679220346"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="#local-6989586621679220345"><span class="hs-identifier hs-var">pe</span></a><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span class="hs-comment">-- | Produce a pair of lists from a 'ParseFlags' value representing</span><span>
</span><a name="line-235"></a><span class="hs-comment">-- language extensions to explicitly enable/disable.</span><span>
</span><a name="line-236"></a><span class="hs-identifier">ghcExtensionsFromParseFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.All.html#ParseFlags"><span class="hs-identifier hs-type">ParseFlags</span></a><span>
</span><a name="line-237"></a><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">GHC.Extension</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">GHC.Extension</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-238"></a><a name="ghcExtensionsFromParseFlags"><a href="HSE.All.html#ghcExtensionsFromParseFlags"><span class="hs-identifier">ghcExtensionsFromParseFlags</span></a></a><span> </span><a href="HSE.All.html#ParseFlags"><span class="hs-identifier hs-var">ParseFlags</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hseFlags</span><span class="hs-glyph">=</span><span class="hs-identifier hs-var">ParseMode</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">extensions</span><span class="hs-glyph">=</span><a name="local-6989586621679220348"><a href="#local-6989586621679220348"><span class="hs-identifier">exts</span></a></a><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-glyph">=</span><span>
</span><a name="line-239"></a><span>   </span><span class="hs-identifier hs-var">partitionEithers</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span> </span><a href="#local-6989586621679220349"><span class="hs-identifier hs-var">toEither</span></a><span> </span><a href="#local-6989586621679220348"><span class="hs-identifier hs-var">exts</span></a><span>
</span><a name="line-240"></a><span>   </span><span class="hs-keyword">where</span><span>
</span><a name="line-241"></a><span>     </span><a name="local-6989586621679220349"><a href="#local-6989586621679220349"><span class="hs-identifier">toEither</span></a></a><span> </span><a name="local-6989586621679220350"><a href="#local-6989586621679220350"><span class="hs-identifier">ke</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679220350"><span class="hs-identifier hs-var">ke</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-242"></a><span>       </span><span class="hs-identifier hs-var">EnableExtension</span><span> </span><a name="local-6989586621679220351"><a href="#local-6989586621679220351"><span class="hs-identifier">e</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span>  </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="GHC.Util.html#readExtension"><span class="hs-identifier hs-var">readExtension</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679220351"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-243"></a><span>       </span><span class="hs-identifier hs-var">DisableExtension</span><span> </span><a name="local-6989586621679220352"><a href="#local-6989586621679220352"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="GHC.Util.html#readExtension"><span class="hs-identifier hs-var">readExtension</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679220352"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-244"></a><span>       </span><span class="hs-identifier hs-var">UnknownExtension</span><span> </span><span class="hs-special">(</span><span class="hs-char">'N'</span><span class="hs-glyph">:</span><span class="hs-char">'o'</span><span class="hs-glyph">:</span><a name="local-6989586621679220353"><a href="#local-6989586621679220353"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="GHC.Util.html#readExtension"><span class="hs-identifier hs-var">readExtension</span></a><span> </span><a href="#local-6989586621679220353"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-245"></a><span>       </span><span class="hs-identifier hs-var">UnknownExtension</span><span> </span><a name="local-6989586621679220354"><a href="#local-6989586621679220354"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="GHC.Util.html#readExtension"><span class="hs-identifier hs-var">readExtension</span></a><span> </span><a href="#local-6989586621679220354"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span class="hs-comment">-- | Parse a Haskell module. Applies the C pre processor, and uses</span><span>
</span><a name="line-248"></a><span class="hs-comment">-- best-guess fixity resolution if there are ambiguities.  The</span><span>
</span><a name="line-249"></a><span class="hs-comment">-- filename @-@ is treated as @stdin@. Requires some flags (often</span><span>
</span><a name="line-250"></a><span class="hs-comment">-- 'defaultParseFlags'), the filename, and optionally the contents of</span><span>
</span><a name="line-251"></a><span class="hs-comment">-- that file. This version uses both hs-src-exts AND ghc-lib.</span><span>
</span><a name="line-252"></a><span class="hs-identifier">parseModuleEx</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.All.html#ParseFlags"><span class="hs-identifier hs-type">ParseFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="HSE.All.html#ParseError"><span class="hs-identifier hs-type">ParseError</span></a><span> </span><a href="HSE.All.html#ModuleEx"><span class="hs-identifier hs-type">ModuleEx</span></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><a name="parseModuleEx"><a href="HSE.All.html#parseModuleEx"><span class="hs-identifier">parseModuleEx</span></a></a><span> </span><a name="local-6989586621679220355"><a href="#local-6989586621679220355"><span class="hs-identifier">flags</span></a></a><span> </span><a name="local-6989586621679220356"><a href="#local-6989586621679220356"><span class="hs-identifier">file</span></a></a><span> </span><a name="local-6989586621679220357"><a href="#local-6989586621679220357"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Timing.html#timedIO"><span class="hs-identifier hs-var">timedIO</span></a><span> </span><span class="hs-string">&quot;Parse&quot;</span><span> </span><a href="#local-6989586621679220356"><span class="hs-identifier hs-var">file</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-254"></a><span>        </span><a name="local-6989586621679220363"><a href="#local-6989586621679220363"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679220357"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-255"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679220362"><a href="#local-6989586621679220362"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679220362"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-256"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679220356"><span class="hs-identifier hs-var">file</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-string">&quot;-&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Util.html#getContentsUTF8"><span class="hs-identifier hs-var">getContentsUTF8</span></a><span>
</span><a name="line-257"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">readFileUTF8'</span><span> </span><a href="#local-6989586621679220356"><span class="hs-identifier hs-var">file</span></a><span>
</span><a name="line-258"></a><span>        </span><a name="local-6989586621679220364"><a href="#local-6989586621679220364"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><a href="#local-6989586621679220363"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">stripPrefix</span><span> </span><span class="hs-string">&quot;\65279&quot;</span><span> </span><a href="#local-6989586621679220363"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-comment">-- remove the BOM if it exists, see #130</span><span>
</span><a name="line-259"></a><span>        </span><a name="local-6989586621679220365"><a href="#local-6989586621679220365"><span class="hs-identifier">ppstr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HSE.All.html#runCpp"><span class="hs-identifier hs-var">runCpp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">cppFlags</span><span> </span><a href="#local-6989586621679220355"><span class="hs-identifier hs-var">flags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679220356"><span class="hs-identifier hs-var">file</span></a><span> </span><a href="#local-6989586621679220364"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-260"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679220366"><a href="#local-6989586621679220366"><span class="hs-identifier">enableDisableExts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HSE.All.html#ghcExtensionsFromParseFlags"><span class="hs-identifier hs-var">ghcExtensionsFromParseFlags</span></a><span> </span><a href="#local-6989586621679220355"><span class="hs-identifier hs-var">flags</span></a><span>
</span><a name="line-261"></a><span>        </span><a name="local-6989586621679220367"><a href="#local-6989586621679220367"><span class="hs-identifier">dynFlags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.Util.html#parsePragmasIntoDynFlags"><span class="hs-identifier hs-var">parsePragmasIntoDynFlags</span></a><span> </span><a href="GHC.Util.html#baseDynFlags"><span class="hs-identifier hs-var">baseDynFlags</span></a><span> </span><a href="#local-6989586621679220366"><span class="hs-identifier hs-var">enableDisableExts</span></a><span> </span><a href="#local-6989586621679220356"><span class="hs-identifier hs-var">file</span></a><span> </span><a href="#local-6989586621679220365"><span class="hs-identifier hs-var">ppstr</span></a><span>
</span><a name="line-262"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679220367"><span class="hs-identifier hs-var">dynFlags</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-263"></a><span>          </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679220368"><a href="#local-6989586621679220368"><span class="hs-identifier">ghcFlags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-264"></a><span>            </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">parseFileContentsWithComments</span><span> </span><span class="hs-special">(</span><a href="HSE.All.html#mkMode"><span class="hs-identifier hs-var">mkMode</span></a><span> </span><a href="#local-6989586621679220355"><span class="hs-identifier hs-var">flags</span></a><span> </span><a href="#local-6989586621679220356"><span class="hs-identifier hs-var">file</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679220365"><span class="hs-identifier hs-var">ppstr</span></a><span class="hs-special">,</span><span> </span><a href="GHC.Util.html#parseFileGhcLib"><span class="hs-identifier hs-var">parseFileGhcLib</span></a><span> </span><a href="#local-6989586621679220356"><span class="hs-identifier hs-var">file</span></a><span> </span><a href="#local-6989586621679220365"><span class="hs-identifier hs-var">ppstr</span></a><span> </span><a href="#local-6989586621679220368"><span class="hs-identifier hs-var">ghcFlags</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-265"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ParseOk</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679220369"><a href="#local-6989586621679220369"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679220370"><a href="#local-6989586621679220370"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">POk</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679220371"><a href="#local-6989586621679220371"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-266"></a><span>                    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="HSE.All.html#ModuleEx"><span class="hs-identifier hs-var">ModuleEx</span></a><span> </span><span class="hs-special">(</span><a href="HSE.All.html#applyFixity"><span class="hs-identifier hs-var">applyFixity</span></a><span> </span><a href="#local-6989586621679220359"><span class="hs-identifier hs-var">fixity</span></a><span> </span><a href="#local-6989586621679220369"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679220370"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679220371"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-267"></a><span>                </span><span class="hs-comment">-- Parse error if GHC parsing fails (see</span><span>
</span><a name="line-268"></a><span>                </span><span class="hs-comment">-- https://github.com/ndmitchell/hlint/issues/645).</span><span>
</span><a name="line-269"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ParseOk</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">PFailed</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679220372"><a href="#local-6989586621679220372"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679220373"><a href="#local-6989586621679220373"><span class="hs-identifier">err</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-270"></a><span>                    </span><a href="HSE.All.html#ghcFailOpParseModuleEx"><span class="hs-identifier hs-var">ghcFailOpParseModuleEx</span></a><span> </span><a href="#local-6989586621679220365"><span class="hs-identifier hs-var">ppstr</span></a><span> </span><a href="#local-6989586621679220356"><span class="hs-identifier hs-var">file</span></a><span> </span><a href="#local-6989586621679220364"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679220372"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679220373"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span>
</span><a name="line-271"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ParseFailed</span><span> </span><a name="local-6989586621679220374"><a href="#local-6989586621679220374"><span class="hs-identifier">sl</span></a></a><span> </span><a name="local-6989586621679220375"><a href="#local-6989586621679220375"><span class="hs-identifier">msg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679220376"><a href="#local-6989586621679220376"><span class="hs-identifier">pfailed</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-272"></a><span>                    </span><a href="HSE.All.html#failOpParseModuleEx"><span class="hs-identifier hs-var">failOpParseModuleEx</span></a><span> </span><a href="#local-6989586621679220365"><span class="hs-identifier hs-var">ppstr</span></a><span> </span><a href="#local-6989586621679220355"><span class="hs-identifier hs-var">flags</span></a><span> </span><a href="#local-6989586621679220356"><span class="hs-identifier hs-var">file</span></a><span> </span><a href="#local-6989586621679220364"><span class="hs-identifier hs-var">str</span></a><span> </span><a href="#local-6989586621679220374"><span class="hs-identifier hs-var">sl</span></a><span> </span><a href="#local-6989586621679220375"><span class="hs-identifier hs-var">msg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679220358"><span class="hs-identifier hs-var">fromPFailed</span></a><span> </span><a href="#local-6989586621679220376"><span class="hs-identifier hs-var">pfailed</span></a><span>
</span><a name="line-273"></a><span>          </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679220377"><a href="#local-6989586621679220377"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-274"></a><span>            </span><span class="hs-comment">-- Parsing GHC flags from dynamic pragmas in the source</span><span>
</span><a name="line-275"></a><span>            </span><span class="hs-comment">-- has failed. When this happens, it's reported by</span><span>
</span><a name="line-276"></a><span>            </span><span class="hs-comment">-- exception. It's impossible or at least fiddly getting a</span><span>
</span><a name="line-277"></a><span>            </span><span class="hs-comment">-- location so we skip that for now. Synthesize a parse</span><span>
</span><a name="line-278"></a><span>            </span><span class="hs-comment">-- error.</span><span>
</span><a name="line-279"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679220378"><a href="#local-6989586621679220378"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">SrcLoc</span><span> </span><a href="#local-6989586621679220356"><span class="hs-identifier hs-var">file</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-280"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="HSE.All.html#ParseError"><span class="hs-identifier hs-var">ParseError</span></a><span> </span><a href="#local-6989586621679220378"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621679220377"><span class="hs-identifier hs-var">msg</span></a><span> </span><span class="hs-special">(</span><a href="HSE.All.html#context"><span class="hs-identifier hs-var">context</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">srcLine</span><span> </span><a href="#local-6989586621679220378"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679220365"><span class="hs-identifier hs-var">ppstr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-281"></a><span>
</span><a name="line-282"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-283"></a><span>        </span><a name="local-6989586621679220358"><a href="#local-6989586621679220358"><span class="hs-identifier">fromPFailed</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PFailed</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679220360"><a href="#local-6989586621679220360"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679220361"><a href="#local-6989586621679220361"><span class="hs-identifier">err</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679220360"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679220361"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span>
</span><a name="line-284"></a><span>        </span><span class="hs-identifier">fromPFailed</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><span>        </span><a name="local-6989586621679220359"><a href="#local-6989586621679220359"><span class="hs-identifier">fixity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">fixities</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">hseFlags</span><span> </span><a href="#local-6989586621679220355"><span class="hs-identifier hs-var">flags</span></a><span>
</span><a name="line-287"></a><span>
</span><a name="line-288"></a><span class="hs-comment">-- | Given a line number, and some source code, put bird ticks around the appropriate bit.</span><span>
</span><a name="line-289"></a><span class="hs-identifier">context</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-290"></a><a name="context"><a href="HSE.All.html#context"><span class="hs-identifier">context</span></a></a><span> </span><a name="local-6989586621679220379"><a href="#local-6989586621679220379"><span class="hs-identifier">lineNo</span></a></a><span> </span><a name="local-6989586621679220380"><a href="#local-6989586621679220380"><span class="hs-identifier">src</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-291"></a><span>    </span><span class="hs-identifier hs-var">unlines</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">dropWhileEnd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">dropWhile</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-292"></a><span>    </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">++</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679220381"><span class="hs-identifier hs-var">ticks</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-number">5</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679220379"><span class="hs-identifier hs-var">lineNo</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">3</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">lines</span><span> </span><a href="#local-6989586621679220380"><span class="hs-identifier hs-var">src</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-293"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679220381"><a href="#local-6989586621679220381"><span class="hs-identifier">ticks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;  &quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;  &quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;&gt; &quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;  &quot;</span><span class="hs-special">,</span><span class="hs-string">&quot;  &quot;</span><span class="hs-special">]</span><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span>
</span><a name="line-296"></a><span class="hs-comment">---------------------------------------------------------------------</span><span>
</span><a name="line-297"></a><span class="hs-comment">-- FIXITIES</span><span>
</span><a name="line-298"></a><span>
</span><a name="line-299"></a><span class="hs-comment">-- resolve fixities later, so we don't ever get uncatchable ambiguity errors</span><span>
</span><a name="line-300"></a><span class="hs-comment">-- if there are fixity errors, try the cheapFixities (which never fails)</span><span>
</span><a name="line-301"></a><span class="hs-identifier">applyFixity</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Fixity</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Type.html#Module_"><span class="hs-identifier hs-type">Module_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Type.html#Module_"><span class="hs-identifier hs-type">Module_</span></a><span>
</span><a name="line-302"></a><a name="applyFixity"><a href="HSE.All.html#applyFixity"><span class="hs-identifier">applyFixity</span></a></a><span> </span><a name="local-6989586621679220382"><a href="#local-6989586621679220382"><span class="hs-identifier">base</span></a></a><span> </span><a name="local-6989586621679220383"><a href="#local-6989586621679220383"><span class="hs-identifier">modu</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">descendBi</span><span> </span><a href="#local-6989586621679220384"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679220383"><span class="hs-identifier hs-var">modu</span></a><span>
</span><a name="line-303"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-304"></a><span>        </span><a name="local-6989586621679220384"><a href="#local-6989586621679220384"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679220386"><a href="#local-6989586621679220386"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-special">(</span><a href="HSE.All.html#cheapFixities"><span class="hs-identifier hs-var">cheapFixities</span></a><span> </span><a href="#local-6989586621679220385"><span class="hs-identifier hs-var">fixs</span></a><span> </span><a href="#local-6989586621679220386"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">applyFixities</span><span> </span><a href="#local-6989586621679220385"><span class="hs-identifier hs-var">fixs</span></a><span> </span><a href="#local-6989586621679220386"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HSE.Type.html#Decl_"><span class="hs-identifier hs-type">Decl_</span></a><span>
</span><a name="line-305"></a><span>        </span><a name="local-6989586621679220385"><a href="#local-6989586621679220385"><span class="hs-identifier">fixs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="HSE.Util.html#getFixity"><span class="hs-identifier hs-var">getFixity</span></a><span> </span><span class="hs-special">(</span><a href="HSE.Util.html#moduleDecls"><span class="hs-identifier hs-var">moduleDecls</span></a><span> </span><a href="#local-6989586621679220383"><span class="hs-identifier hs-var">modu</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679220382"><span class="hs-identifier hs-var">base</span></a><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span>
</span><a name="line-308"></a><span class="hs-comment">-- Apply fixities, but ignoring any ambiguous fixity errors and skipping qualified names,</span><span>
</span><a name="line-309"></a><span class="hs-comment">-- local infix declarations etc. Only use as a backup, if HSE gives an error.</span><span>
</span><a name="line-310"></a><span class="hs-comment">--</span><span>
</span><a name="line-311"></a><span class="hs-comment">-- Inspired by the code at:</span><span>
</span><a name="line-312"></a><span class="hs-comment">-- http://hackage.haskell.org/trac/haskell-prime/attachment/wiki/FixityResolution/resolve.hs</span><span>
</span><a name="line-313"></a><span class="hs-identifier">cheapFixities</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Fixity</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Type.html#Decl_"><span class="hs-identifier hs-type">Decl_</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HSE.Type.html#Decl_"><span class="hs-identifier hs-type">Decl_</span></a><span>
</span><a name="line-314"></a><a name="cheapFixities"><a href="HSE.All.html#cheapFixities"><span class="hs-identifier">cheapFixities</span></a></a><span> </span><a name="local-6989586621679220387"><a href="#local-6989586621679220387"><span class="hs-identifier">fixs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">descendBi</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">transform</span><span> </span><a href="#local-6989586621679220389"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-315"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-316"></a><span>        </span><a name="local-6989586621679220388"><a href="#local-6989586621679220388"><span class="hs-identifier">ask</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HSE.All.html#askFixity"><span class="hs-identifier hs-var">askFixity</span></a><span> </span><a href="#local-6989586621679220387"><span class="hs-identifier hs-var">fixs</span></a><span>
</span><a name="line-317"></a><span>
</span><a name="line-318"></a><span>        </span><a name="local-6989586621679220389"><a href="#local-6989586621679220389"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679220390"><a href="#local-6989586621679220390"><span class="hs-identifier">o</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixApp</span><span> </span><a name="local-6989586621679220391"><a href="#local-6989586621679220391"><span class="hs-identifier">s1</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixApp</span><span> </span><a name="local-6989586621679220392"><a href="#local-6989586621679220392"><span class="hs-identifier">s2</span></a></a><span> </span><a name="local-6989586621679220393"><a href="#local-6989586621679220393"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679220394"><a href="#local-6989586621679220394"><span class="hs-identifier">op1</span></a></a><span> </span><a name="local-6989586621679220395"><a href="#local-6989586621679220395"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679220396"><a href="#local-6989586621679220396"><span class="hs-identifier">op2</span></a></a><span> </span><a name="local-6989586621679220397"><a href="#local-6989586621679220397"><span class="hs-identifier">z</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-319"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679220399"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679220401"><span class="hs-identifier hs-var">p2</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679220398"><span class="hs-identifier hs-var">a1</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679220400"><span class="hs-identifier hs-var">a2</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="HSE.Util.html#isAssocNone"><span class="hs-identifier hs-var">isAssocNone</span></a><span> </span><a href="#local-6989586621679220398"><span class="hs-identifier hs-var">a1</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679220390"><span class="hs-identifier hs-var">o</span></a><span> </span><span class="hs-comment">-- Ambiguous infix expression!</span><span>
</span><a name="line-320"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679220399"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679220401"><span class="hs-identifier hs-var">p2</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679220399"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679220401"><span class="hs-identifier hs-var">p2</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="HSE.Util.html#isAssocLeft"><span class="hs-identifier hs-var">isAssocLeft</span></a><span> </span><a href="#local-6989586621679220398"><span class="hs-identifier hs-var">a1</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="HSE.Util.html#isAssocNone"><span class="hs-identifier hs-var">isAssocNone</span></a><span> </span><a href="#local-6989586621679220400"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679220390"><span class="hs-identifier hs-var">o</span></a><span>
</span><a name="line-321"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">InfixApp</span><span> </span><a href="#local-6989586621679220391"><span class="hs-identifier hs-var">s1</span></a><span> </span><a href="#local-6989586621679220393"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679220394"><span class="hs-identifier hs-var">op1</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679220389"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">InfixApp</span><span> </span><a href="#local-6989586621679220391"><span class="hs-identifier hs-var">s1</span></a><span> </span><a href="#local-6989586621679220395"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621679220396"><span class="hs-identifier hs-var">op2</span></a><span> </span><a href="#local-6989586621679220397"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span>
</span><a name="line-322"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-323"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621679220398"><a href="#local-6989586621679220398"><span class="hs-identifier">a1</span></a></a><span class="hs-special">,</span><a name="local-6989586621679220399"><a href="#local-6989586621679220399"><span class="hs-identifier">p1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679220388"><span class="hs-identifier hs-var">ask</span></a><span> </span><a href="#local-6989586621679220394"><span class="hs-identifier hs-var">op1</span></a><span>
</span><a name="line-324"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621679220400"><a href="#local-6989586621679220400"><span class="hs-identifier">a2</span></a></a><span class="hs-special">,</span><a name="local-6989586621679220401"><a href="#local-6989586621679220401"><span class="hs-identifier">p2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679220388"><span class="hs-identifier hs-var">ask</span></a><span> </span><a href="#local-6989586621679220396"><span class="hs-identifier hs-var">op2</span></a><span>
</span><a name="line-325"></a><span>        </span><span class="hs-identifier">f</span><span> </span><a name="local-6989586621679220402"><a href="#local-6989586621679220402"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679220402"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-326"></a><span>
</span><a name="line-327"></a><span>
</span><a name="line-328"></a><span class="hs-identifier">askFixity</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Fixity</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">QOp</span><span> </span><a href="HSE.Type.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Assoc</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-329"></a><a name="askFixity"><a href="HSE.All.html#askFixity"><span class="hs-identifier">askFixity</span></a></a><span> </span><a name="local-6989586621679220403"><a href="#local-6989586621679220403"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679220409"><a href="#local-6989586621679220409"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Map.findWithDefault</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AssocLeft</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-number">9</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="HSE.Match.html#fromNamed"><span class="hs-identifier hs-var">fromNamed</span></a><span> </span><a href="#local-6989586621679220409"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679220404"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-330"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-331"></a><span>        </span><a name="local-6989586621679220404"><a href="#local-6989586621679220404"><span class="hs-identifier">mp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.fromList</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679220408"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span class="hs-special">(</span><a href="#local-6989586621679220405"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679220406"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Fixity</span><span> </span><a name="local-6989586621679220405"><a href="#local-6989586621679220405"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679220406"><a href="#local-6989586621679220406"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679220407"><a href="#local-6989586621679220407"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679220403"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679220408"><a href="#local-6989586621679220408"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HSE.Match.html#fromNamed"><span class="hs-identifier hs-var">fromNamed</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="HSE.Util.html#an"><span class="hs-identifier hs-var">an</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679220407"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679220408"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-332"></a></pre></body></html>